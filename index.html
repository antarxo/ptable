<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <title>Περιοδικός Πίνακας - Σωστή Ευθυγράμμιση</title>
  <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
  <style>
    body { font-family: 'Roboto', sans-serif; margin: 0; overflow: hidden; background: #f7f7f7; }
    .canvas { 
      position: absolute; 
      background: transparent; 
      transition: opacity 0.5s ease-in-out; 
      opacity: 0; /* Αρχικά αόρατο */
    }
    #canvasTableBackground {
      position: absolute; 
      background: white; 
      border: 1px solid rgba(0,0,0,0.1);
      box-shadow: 0 3px 3px rgba(0,0,0,0.2); 
      z-index: -10; 
      opacity: 1;
    }
    #canvasPeriods { 
      position: absolute; 
      background: #f0f0f0; 
      z-index: 5; 
    }
    #buttonPanel {
      position: fixed; 
      bottom: 20px; 
      right: 20px; 
      z-index: 100;
    }
    #buttonPanel button {
      background-color: #008CBA; 
      color: white; 
      padding: 10px 15px;
      border: none; 
      border-radius: 5px; 
      cursor: pointer;
    }
  </style>
</head>
<body>

  <!-- Background Canvas -->
  <div id="canvasTableBackground"></div>
  <!-- Καμβάς Περιόδων -->
  <div id="canvasPeriods" class="canvas"></div>
  <!-- Καμβάδες Groups -->
  <div id="canvasS_groups" class="canvas"></div>
  <div id="canvasD_groups" class="canvas"></div>
  <div id="canvasP_groups" class="canvas"></div>
  <!-- Καμβάδες για τα στοιχεία (Blocks) -->
  <div id="canvasS" class="canvas"></div>
  <div id="canvasP" class="canvas"></div>
  <div id="canvasD" class="canvas"></div>
  <div id="canvasF" class="canvas"></div>

  <!-- Κουμπί "Συμπλήρωσε" -->
  <div id="buttonPanel">
    <button id="fillAll">Συμπλήρωσε</button>
  </div>

  <script>
    let elements = [];
    let positions = {};
    let tableShiftX = 0;
    let isTableFilled = false;
    let groupOffsetY = -15; // ✅ Οι ομάδες πάντα 15px πιο ψηλά

    async function loadData() {
      elements = await (await fetch('elements.json')).json();
      positions = await (await fetch('positions.json')).json();
      computeGlobalShift();
    }

    function computeGlobalShift() {
      tableShiftX = positions.expanded["1"].x - 55; // ✅ Μόνιμη μετατόπιση δεξιά
    }

    function initializeCanvases() {
      if (isTableFilled) return;
      isTableFilled = true;
      
      ["s", "p", "d", "f"].forEach(block => {
        let container = document.getElementById("canvas" + block.toUpperCase());
        container.innerHTML = "";
        container.style.left = (positions.expanded["1"].x + tableShiftX) + "px";
        container.style.opacity = "1"; // ✅ Εμφάνιση με opacity
  
        new p5(function(p) {
          p.setup = function () {
            let canvas = p.createCanvas(400, 280);
            canvas.parent("canvas" + block.toUpperCase());
          };
        });
      });

      setTimeout(() => {
        initializePeriodsCanvas();
        document.getElementById("canvasPeriods").style.opacity = "1";
      }, 500);
    }

    function initializePeriodsCanvas() {
      new p5(function(p) {
        p.setup = function () {
          let canvas = p.createCanvas(42, 292);
          canvas.parent("canvasPeriods");
          let container = document.getElementById("canvasPeriods");
          container.style.left = (positions.expanded["1"].x - 55) + "px";
          container.style.opacity = "1"; // ✅ Οι περίοδοι εμφανίζονται
          p.noStroke();
          p.textAlign(p.CENTER, p.CENTER);
          p.textSize(12);
          p.textStyle(p.BOLD);
          const periodLabels = ["1η Κ", "2η L", "3η M", "4η N", "5η O", "6η P", "7η Q"];
          for (let i = 0; i < 7; i++) {
            p.fill(240);
            p.rect(0, i * 42, 42, 42);
            p.fill(0);
            p.text(periodLabels[i], 21, i * 42 + 21);
          }
        };
      });
    }

    function initializeGroups() {
      ["S", "D", "P"].forEach(group => {
        let groupId = "canvas" + group + "_groups";
        let container = document.getElementById(groupId);
        container.style.left = (positions.expanded["1"].x + tableShiftX) + "px"; // ✅ Χρήση global shift
        container.style.top = (78 + groupOffsetY) + "px";
        container.style.opacity = "1";
      });
    }

    document.getElementById('fillAll').addEventListener('click', function() {
      initializeCanvases();
      initializeGroups();
    });

    window.addEventListener('load', loadData);
  </script>

</body>
</html>
