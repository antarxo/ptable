<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <title>Περιοδικός Πίνακας - Συμπλήρωσε με Groups & Periods</title>
  <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
  <style>
    body { 
      font-family: 'Roboto', sans-serif; 
      margin: 0; 
      overflow: hidden; 
      background: #f7f7f7; 
    }
    .canvas { 
      position: absolute; 
      background: transparent; 
      transition: all 0.5s ease-in-out; 
    }
    /* Background canvas (πλαίσιο) */
    #canvasTableBackground {
      position: absolute; 
      background: white; 
      border: 1px solid rgba(0,0,0,0.1);
      box-shadow: 0 3px 3px rgba(0,0,0,0.2); 
      z-index: -10; 
      display: block;
    }
    /* Καμβάς περιόδων όπως στο ALLtoDOM1 */
    #canvasPeriods { 
      position: absolute; 
      left: 31px; 
      top: 120px; 
      width: 42px; 
      height: 292px; 
      background: #f0f0f0; 
      z-index: 5; 
      display: block; 
    }
    /* Ομαδικοί καμβάδες – θα τοποθετηθούν με left ίσο με το left του τομέα (block) */
    /* Δεν απαιτείται επιπλέον styling εδώ */
    #buttonPanel {
      position: fixed; 
      bottom: 20px; 
      right: 20px; 
      z-index: 100;
    }
    #buttonPanel button {
      background-color: #008CBA; 
      color: white; 
      padding: 10px 15px;
      border: none; 
      border-radius: 5px; 
      cursor: pointer;
    }
  </style>
</head>
<body>

  <!-- Background Canvas -->
  <div id="canvasTableBackground"></div>
  <!-- Καμβάς Περιόδων -->
  <div id="canvasPeriods" class="canvas"></div>
  <!-- Καμβάδες Groups -->
  <div id="canvasS_groups" class="canvas"></div>
  <div id="canvasD_groups" class="canvas"></div>
  <div id="canvasP_groups" class="canvas"></div>
  <!-- Καμβάδες για τα στοιχεία (Blocks) -->
  <div id="canvasS" class="canvas"></div>
  <div id="canvasP" class="canvas"></div>
  <div id="canvasD" class="canvas"></div>
  <div id="canvasF" class="canvas"></div>

  <!-- Κουμπί "Συμπλήρωσε" -->
  <div id="buttonPanel">
    <button id="fillAll">Συμπλήρωσε</button>
  </div>

  <script>
    let elements = [];
    let positions = {};
    let blockOffsets = {}; 
    let isTableFilled = false; // Flag ώστε να δημιουργείται μόνο μία φορά η εμφάνιση

    // Φόρτωση δεδομένων από τα JSON
    async function loadData() {
      elements = await (await fetch('elements.json')).json();
      positions = await (await fetch('positions.json')).json();
      computeBlockOffsets();
      initializeBackgroundCanvas();
      initializePeriodsCanvas();
      initializeSGroupsCanvas();
      initializeDGroupsCanvas();
      initializePGroupsCanvas();
    }

    // Υπολογισμός offsets για κάθε block (s, p, d, f)
    function computeBlockOffsets() {
      ["s", "p", "d", "f"].forEach(block => {
        let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;
        Object.keys(positions.expanded).forEach(num => {
          let el = elements.find(e => e.number == num);
          if (el && el.block === block) {
            let pos = positions.expanded[num];
            minX = Math.min(minX, pos.x);
            minY = Math.min(minY, pos.y);
            maxX = Math.max(maxX, pos.x + pos.width);
            maxY = Math.max(maxY, pos.y + pos.height);
          }
        });
        blockOffsets[block] = { minX, minY, width: maxX - minX, height: maxY - minY };
      });
    }

    // Υπολογισμός σχετικής θέσης ενός στοιχείου μέσα στο block
    function calculateRelativePosition(element, block) {
      let pos = positions.expanded[element.number];
      let offset = blockOffsets[block];
      return { x: pos.x - offset.minX, y: pos.y - offset.minY };
    }

    // Δημιουργία καμβάδων για τα στοιχεία (Blocks) με σχεδίαση μέσω p5.js
    function initializeCanvases() {
      if (isTableFilled) return;
      isTableFilled = true;
      
      ["s", "p", "d", "f"].forEach(block => {
        let offset = blockOffsets[block];
        let container = document.getElementById("canvas" + block.toUpperCase());
        container.innerHTML = "";
        // Ορισμός θέσης και διαστάσεων του container σύμφωνα με το block offset
        container.style.left = offset.minX + "px";
        container.style.top = offset.minY + "px";
        container.style.width = offset.width + "px";
        container.style.height = offset.height + "px";
  
        new p5(function(p) {
          p.setup = function () {
            let canvas = p.createCanvas(offset.width, offset.height);
            canvas.parent("canvas" + block.toUpperCase());
            drawElements(p, block);
          };
        });
      });
    }

    // Σχεδίαση των κελιών για κάθε block – χρησιμοποιούμε textSize 14 και έντονο στυλ
    function drawElements(p, block) {
      const blockColors = { s: "#FF477E", p: "#26FF31", d: "#3F99FF", f: "#FFD051" };
      elements.filter(e => e.block === block).forEach(e => {
        let pos = calculateRelativePosition(e, block);
        p.fill(blockColors[block]);
        p.noStroke();
        p.rect(pos.x, pos.y, 40, 40, 5);
        p.fill(0);
        p.textSize(14);
        p.textStyle(p.BOLD);
        p.textAlign(p.CENTER, p.CENTER);
        p.text(e.number, pos.x + 20, pos.y + 25);
      });
    }

    // Αρχικοποίηση του background καμβά (πλαίσιο πίνακα)
    function initializeBackgroundCanvas() {
      let bg = document.getElementById("canvasTableBackground");
      bg.style.left = "10px";
      bg.style.top = "50px";
      bg.style.width = "1412px";
      bg.style.height = "368px";
      bg.style.display = "block";
    }

    // Δημιουργία του καμβά για τις περιόδους όπως στο ALLtoDOM1, με textSize 14 και έντονο στυλ
    function initializePeriodsCanvas() {
      new p5(function(p) {
        p.setup = function () {
          let canvas = p.createCanvas(40, 294);
          canvas.parent("canvasPeriods");
          let container = document.getElementById("canvasPeriods");
          container.style.left = (positions.expanded["1"].x - 55) + "px";
          container.style.top = positions.expanded["1"].y + "px";
          p.noStroke();
          p.textAlign(p.CENTER, p.CENTER);
          p.textSize(14);
          p.textStyle(p.BOLD);
          const periodLabels = ["1", "2", "3", "4", "5", "6", "7"];
          for (let i = 0; i < 7; i++) {
            p.fill(240);
            p.rect(0, i * 42, 40, 40);
            p.fill(0);
            p.text(periodLabels[i], 20, i * 42 + 20);
          }
        };
      });
    }

    // Δημιουργία του καμβά για τα S-groups – το left του container ορίζεται ως το left του τομέα (block S)
    function initializeSGroupsCanvas() {
      new p5(function(p){
        p.setup = function(){
          let canvas = p.createCanvas(84, 40);
          canvas.parent("canvasS_groups");
          let container = document.getElementById("canvasS_groups");
          // Ορισμός left ίσο με το left του τομέα s
          container.style.left = blockOffsets["s"].minX + "px";
          container.style.top = "78px"; // τιμή όπως στο ALLtoDOM1
          p.noStroke();
          p.textAlign(p.CENTER, p.CENTER);
          p.textSize(14);
          p.textStyle(p.BOLD);
          p.background(240);
          p.text("1", 20, 10);
          p.text("2", 62, 10);
          p.text("ΙΑ", 20, 30);
          p.text("ΙΙΑ", 62, 30);
        };
      });
    }

    // Δημιουργία του καμβά για τα D-groups – left ίσο με το left του τομέα d
    function initializeDGroupsCanvas() {
      new p5(function(p) {
        p.setup = function(){
          let canvas = p.createCanvas(418, 40);
          canvas.parent("canvasD_groups");
          let container = document.getElementById("canvasD_groups");
          container.style.left = blockOffsets["d"].minX + "px";
          container.style.top = "78px";
          p.noStroke();
          p.textAlign(p.CENTER, p.CENTER);
          p.textSize(14);
          p.textStyle(p.BOLD);
          p.background(240);
          for(let c = 0; c < 10; c++){
            let x = c * (40 + 2);
            p.fill(240);
            p.rect(x, 0, 40, 20);
            p.fill(0);
            p.text((c+3).toString(), x + 20, 10);
          }
          const oldLabels = ["IIIB", "IVB", "VB", "VIB", "VIIB", "VIIIB", "VIIIB", "VIIIB", "IB", "IIB"];
          for(let c = 0; c < 10; c++){
            let x = c * (40 + 2);
            p.fill(240);
            p.rect(x, 22, 40, 20);
            p.fill(0);
            p.text(oldLabels[c], x + 20, 32);
          }
        };
      });
    }

    // Δημιουργία του καμβά για τα P-groups – left ίσο με το left του τομέα p
    function initializePGroupsCanvas() {
      new p5(function(p) {
        p.setup = function(){
          let canvas = p.createCanvas(250, 40);
          canvas.parent("canvasP_groups");
          let container = document.getElementById("canvasP_groups");
          container.style.left = blockOffsets["p"].minX + "px";
          container.style.top = "78px";
          p.noStroke();
          p.textAlign(p.CENTER, p.CENTER);
          p.textSize(14);
          p.textStyle(p.BOLD);
          p.background(240);
          for(let c = 0; c < 6; c++){
            let x = c * (40 + 2);
            p.fill(240);
            p.rect(x, 0, 40, 20);
            p.fill(0);
            p.text((c+13).toString(), x + 20, 10);
          }
          const oldLabels = ["IIIA", "IVA", "VA", "VIA", "VIIA", "VIIIA"];
          for(let c = 0; c < 6; c++){
            let x = c * (40 + 2);
            p.fill(240);
            p.rect(x, 22, 40, 20);
            p.fill(0);
            p.text(oldLabels[c], x + 20, 32);
          }
        };
      });
    }

    // Ενεργοποίηση του "Συμπλήρωσε" με το πάτημα του κουμπιού, δημιουργώντας τους καμβάδες για τα στοιχεία
    document.getElementById('fillAll').addEventListener('click', function() {
      initializeCanvases();
    });

    window.addEventListener('load', loadData);
  </script>

</body>
</html>
