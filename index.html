<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <title>Περιοδικός Πίνακας - Τελικός Κώδικας</title>
  <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
  <style>
    body { 
      font-family: 'Roboto', sans-serif; 
      margin: 0; 
      overflow: hidden; 
      background: #f7f7f7; 
    }
    .canvas { 
      position: absolute; 
      background: transparent; 
      transition: all 0.5s ease-in-out; 
    }
    canvas {
      padding: 8px;
      filter: drop-shadow(4px 4px 4px rgba(0,0,0,0.5));
      overflow: visible;
    }
    /* Background canvas με μεγαλύτερο αλλά πιο αχνό εφέ σκίασης */
    #canvasTableBackground {
      position: absolute; 
      background: white; 
      border: 1px solid rgba(0,0,0,0.1);
      box-shadow: 6px 6px 10px rgba(0,0,0,0.3); 
      z-index: -10;
      opacity: 1;
      transition: all 0.5s ease-in-out;
    }
    /* Ομαδοποίηση καμβάδων ομάδων με z-index στο ανώτερο επίπεδο */
    #canvasS_groups, #canvasD_groups, #canvasP_groups { 
      position: absolute;
      z-index: 60;
    }
    /* Καμβάδες τομέων και περιοδών */
    #canvasS { z-index: 10; }
    #canvasF { z-index: 20; }
    #canvasD { z-index: 30; }
    #canvasP { z-index: 40; }
    #canvasPeriods { z-index: 50; display: none; }
    /* Κουμπιά: τοποθέτηση κατακόρυφα με σκίαση και διάταξη από πάνω προς τα κάτω */
    #buttonPanel {
      position: fixed; 
      bottom: 20px; 
      right: 20px; 
      z-index: 100;
      display: flex; 
      flex-direction: column;
      gap: 5px;
    }
    #buttonPanel button {
      background-color: #008CBA; 
      color: white; 
      padding: 10px 15px;
      border: none; 
      border-radius: 5px; 
      cursor: pointer;
      box-shadow: 4px 4px 4px rgba(0,0,0,0.5);
    }
  </style>
</head>
<body>

  <!-- Καμβάδες -->
  <div id="canvasTableBackground"></div>
  <div id="canvasS_groups" class="canvas"></div>
  <div id="canvasD_groups" class="canvas" style="display:none;" id="canvasD_groups"></div>
  <div id="canvasP_groups" class="canvas" style="display:none;" id="canvasP_groups"></div>
  
  <div id="canvasPeriods" class="canvas"></div>
  <div id="canvasS" class="canvas"></div>
  <div id="canvasD" class="canvas"></div>
  <div id="canvasP" class="canvas"></div>
  <div id="canvasF" class="canvas"></div>

  <!-- Κουμπιά με σειρά: Επόμενο, Συμπλήρωσε, Σύμπτυξε/Ανάπτυξε, Reset -->
  <div id="buttonPanel">
    <button id="nextState" disabled>Επόμενο</button>
    <button id="fillAll">Συμπλήρωσε</button>
    <button id="toggleFBlock" disabled>Σύμπτυξε</button>
    <button id="reset">Reset</button>
  </div>

  <script>
    let elements = [];
    let positions = {};
    let isTableFilled = false;
    let isCollapsed = false;
    let currentMode = "expanded"; // αρχική κατάσταση

    // Νέα μεταβλητή για τον έλεγχο της προοδευτικής εμφάνισης
    let currentZ = 2;  // Ξεκινάμε από 2 ώστε με το πρώτο πάτημα να γίνει 3

    // Συνάρτηση ενημέρωσης της τοποθέτησης των τομέων με βάση το currentZ
    function updateSectors() {
      let shiftP = 0, shiftD = 0;
      // Για currentZ από 3 έως 20: καμία μετατόπιση
      if (currentZ <= 20) {
        shiftP = 0; shiftD = 0;
      } else if (currentZ >= 21 && currentZ <= 30) {
        // Μετάβαση από το 20 στο 21: μετατόπιση του p κατά 42px ανά βήμα
        shiftP = 42 * (currentZ - 20);
      } else if (currentZ >= 31 && currentZ <= 56) {
        // Από το 31 έως το 56: η μετατόπιση του p παραμένει σταθερή στο 42*10
        shiftP = 42 * 10;
      } else if (currentZ >= 57 && currentZ <= 70) {
        // Από το 57 έως το 70: μετατόπιση του p και d κατά 42px ανά βήμα, προσθέτοντας πάνω στο 42*10\n        shiftP = 42 * 10 + 42 * (currentZ - 56);\n        shiftD = 42 * (currentZ - 56);\n      } else if (currentZ > 70) {\n        shiftP = 42 * 10 + 42 * 14;\n        shiftD = 42 * 14;\n      }\n\n      // Εφαρμογή μετατοπίσεων στους καμβάδες p και d\n      let cP = document.getElementById('canvasP');\n      if(cP) { cP.style.transition = \"left 1.2s ease\"; cP.style.left = (159 + shiftP) + \"px\"; }\n      let cD = document.getElementById('canvasD');\n      if(cD) { cD.style.transition = \"left 1.2s ease\"; cD.style.left = (159 + shiftD) + \"px\"; }\n    }\n\n    // Νέα συνάρτηση για την ενημέρωση του currentZ και την εμφάνιση στοιχείων/περιοδών/ομάδων\n    function updateTable() {\n      // Αν currentZ < 3, το θέτουμε στο 3\n      if (currentZ < 3) {\n        currentZ = 3;\n      } else if (currentZ < 118) {\n        currentZ++;\n      } else if (currentZ === 118) {\n        currentZ = 119;  // Εμφάνιση του στοιχείου 1 (αντί για το 119)\n      } else if (currentZ === 119) {\n        currentZ = 120;  // Εμφάνιση του στοιχείου 2\n      } else if (currentZ === 120) {\n        currentZ = 121;  // Εμφάνιση περιόδων\n        document.getElementById('canvasPeriods').style.display = 'block';\n      } else if (currentZ === 121) {\n        currentZ = 122;  // Εμφάνιση ομάδων\n        document.getElementById('canvasS_groups').style.display = 'block';\n        document.getElementById('canvasD_groups').style.display = 'block';\n        document.getElementById('canvasP_groups').style.display = 'block';\n      }\n\n      // Ανανεώνουμε το background και τους καμβάδες\n      initializeBackgroundCanvas();\n      initializeSectorsCanvas();\n      // Εφαρμόζουμε τις μετατοπίσεις\n      updateSectors();\n      // Εμφάνιση του τρέχοντος currentZ για debugging\n      console.log('CurrentZ:', currentZ);\n    }\n\n    // Οι υπόλοιπες συναρτήσεις παραμένουν όπως ήταν\n\n    function computeRightLimit(block) {\n      let maxX = -Infinity;\n      elements.filter(e => e.block === block).forEach(e => {\n        let pos = positions[currentMode][e.number];\n        if (pos) {\n          maxX = Math.max(maxX, pos.x + pos.width);\n        }\n      });\n      return maxX;\n    }\n\n    function computeBottomLimit(block) {\n      let maxY = -Infinity;\n      elements.filter(e => e.block === block).forEach(e => {\n        let pos = positions[currentMode][e.number];\n        if (pos) {\n          maxY = Math.max(maxY, pos.y + pos.height);\n        }\n      });\n      return maxY;\n    }\n\n    function initializeBackgroundCanvas() {\n      let bg = document.getElementById(\"canvasTableBackground\");\n      let leftFixed = 17;\n      let topFixed = 55;\n      let rightLimit, bottomLimit;\n      \n      if (currentMode === \"expanded\" || currentMode === \"collapsed\") {\n        rightLimit = computeRightLimit(\"p\") + 20;\n      } else if (currentMode === \"start\") {\n        rightLimit = computeRightLimit(\"f\") + 20;\n      }\n      \n      bottomLimit = computeBottomLimit(\"f\") + 20;\n      \n      bg.style.left = leftFixed + \"px\";\n      bg.style.top = topFixed + \"px\";\n      bg.style.width = (rightLimit - leftFixed) + \"px\";\n      bg.style.height = (bottomLimit - topFixed) + \"px\";\n      bg.style.opacity = \"1\";\n    }\n\n    async function loadData() {\n      elements = await (await fetch('elements.json')).json();\n      positions = await (await fetch('positions.json')).json();\n    }\n\n    function initializePeriodsCanvas() {\n      new p5(function(p) {\n        p.setup = function() {\n          let canvas = p.createCanvas(40, 292);\n          canvas.parent(\"canvasPeriods\");\n          let container = document.getElementById(\"canvasPeriods\");\n          let bgLeft = parseInt(document.getElementById(\"canvasTableBackground\").style.left);\n          container.style.left = (bgLeft + 6) + \"px\";\n          container.style.top = positions[currentMode][\"1\"].y + \"px\";\n          p.noStroke();\n          p.textAlign(p.CENTER, p.CENTER);\n          p.textSize(11);\n          p.textStyle(p.BOLD);\n          const periodLabels = [\"1η K\", \"2η L\", \"3η M\", \"4η N\", \"5η Ο\", \"6η Ρ\", \"7η Q\"];\n          for (let i = 0; i < 7; i++) {\n            p.fill(240);\n            p.rect(0, i * 42, 40, 40);\n            p.fill(0);\n            p.text(periodLabels[i], 20, i * 42 + 20);\n          }\n        };\n      });\n    }\n\n    function initGroupsCanvases() {\n      new p5(function(p) {\n        p.setup = function() {\n          let canvas = p.createCanvas(82, 40);\n          canvas.parent(\"canvasS_groups\");\n          p.background(240);\n          for (let col = 0; col < 2; col++) {\n            p.noStroke();\n            p.noFill();\n            p.rect(col * 42, 0, 40, 20);\n            p.rect(col * 42, 20, 40, 20);\n          }\n          p.noStroke();\n          p.fill(0);\n          p.textAlign(p.CENTER, p.CENTER);\n          p.textSize(11);\n          p.textStyle(p.BOLD);\n          p.text(\"1\", 20, 10);\n          p.text(\"2\", 20 + 42, 10);\n          p.text(\"IA\", 20, 30);\n          p.text(\"IIA\", 20 + 42, 30);\n        };\n      });\n      \n      new p5(function(p) {\n        p.setup = function() {\n          let canvas = p.createCanvas(418, 40);\n          canvas.parent(\"canvasD_groups\");\n          p.background(240);\n          for (let col = 0; col < 10; col++) {\n            p.noStroke();\n            p.noFill();\n            p.rect(col * 42, 0, 40, 20);\n            p.rect(col * 42, 20, 40, 20);\n          }\n          p.noStroke();\n          p.fill(0);\n          p.textAlign(p.CENTER, p.CENTER);\n          p.textSize(11);\n          p.textStyle(p.BOLD);\n          for (let c = 0; c < 10; c++) {\n            let x = c * 42;\n            p.text((c+3).toString(), x + 20, 10);\n          }\n          const oldLabels = [\"IIIB\",\"IVB\",\"VB\",\"VIB\",\"VIIB\",\"VIIIB\",\"VIIIB\",\"VIIIB\",\"IB\",\"IIB\"];\n          for (let c = 0; c < 10; c++) {\n            let x = c * 42;\n            p.text(oldLabels[c], x + 20, 30);\n          }\n        };\n      });\n      \n      new p5(function(p) {\n        p.setup = function() {\n          let canvas = p.createCanvas(250, 40);\n          canvas.parent(\"canvasP_groups\");\n          p.background(240);\n          for (let col = 0; col < 6; col++) {\n            p.noStroke();\n            p.noFill();\n            p.rect(col * 42, 0, 40, 20);\n            p.rect(col * 42, 20, 40, 20);\n          }\n          p.noStroke();\n          p.fill(0);\n          p.textAlign(p.CENTER, p.CENTER);\n          p.textSize(11);\n          p.textStyle(p.BOLD);\n          for (let c = 0; c < 6; c++) {\n            let x = c * 42;\n            p.text((c+13).toString(), x + 20, 10);\n          }\n          const oldLabels = [\"IIIA\",\"IVA\",\"VA\",\"VIA\",\"VIIA\",\"VIIIA\"];\n          for (let c = 0; c < 6; c++) {\n            let x = c * 42;\n            p.text(oldLabels[c], x + 20, 30);\n          }\n        };\n      });\n      \n      [\"S\", \"D\", \"P\"].forEach(sector => {\n        let sectorCanvas = document.getElementById(\"canvas\" + sector);\n        let groupCanvas = document.getElementById(\"canvas\" + sector + \"_groups\");\n        if(sectorCanvas && groupCanvas) {\n          groupCanvas.style.left = sectorCanvas.style.left;\n          groupCanvas.style.top = (parseInt(positions[currentMode][\"1\"].y) - 42 - 2) + \"px\";\n        }\n      });\n    }\n\n    function initializeSectorsCanvas() {\n      let blocks = [\"s\", \"p\", \"d\", \"f\"];\n      blocks.forEach(block => {\n        let container = document.getElementById(\"canvas\" + block.toUpperCase());\n        container.innerHTML = \"\";\n        let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;\n        elements.filter(e => e.block === block).forEach(e => {\n          let pos = positions[currentMode][e.number];\n          if (pos) {\n            minX = Math.min(minX, pos.x);\n            minY = Math.min(minY, pos.y);\n            maxX = Math.max(maxX, pos.x + pos.width);\n            maxY = Math.max(maxY, pos.y + pos.height);\n          }\n        });\n        if (minX === Infinity || minY === Infinity) return;\n        container.style.left = minX + \"px\";\n        container.style.top = minY + \"px\";\n        container.style.width = (maxX - minX) + \"px\";\n        container.style.height = (maxY - minY) + \"px\";\n        new p5(function(p) {\n          p.setup = function() {\n            let canvas = p.createCanvas(parseInt(container.style.width), parseInt(container.style.height));\n            canvas.parent(\"canvas\" + block.toUpperCase());\n            drawElements(p, block, minX, minY);\n          };\n        });\n      });\n    }\n\n    function drawElements(p, block, containerLeft, containerTop) {\n      let colors = { s: \"#FF477E\", p: \"#26FF31\", d: \"#3F99FF\", f: \"#FFD051\" };\n      elements.filter(e => e.block === block).forEach(e => {\n        let pos = positions[currentMode][e.number];\n        if (pos) {\n          let relativeX = pos.x - containerLeft;\n          let relativeY = pos.y - containerTop;\n          p.fill(colors[block] || \"#CCCCCC\");\n          p.rect(relativeX, relativeY, pos.width, pos.height, 5);\n          p.fill(0);\n          p.textSize(13);\n          p.textStyle(p.BOLD);\n          p.text(e.number, relativeX + pos.width/2, relativeY + pos.height/2);\n        }\n      });\n    }\n\n    document.getElementById('fillAll').addEventListener('click', function() {\n      if (!isTableFilled) {\n        initializeBackgroundCanvas();\n        initializeSectorsCanvas();       \n        initializePeriodsCanvas();       \n        initGroupsCanvases();\n        isTableFilled = true;\n        document.getElementById('toggleFBlock').disabled = false;\n        document.getElementById('nextState').disabled = false;\n      }\n    });\n\n    // Νέα υλοποίηση για το κουμπί \"Επόμενο\" με βάση το currentZ\n    document.getElementById('nextState').addEventListener('click', function() {\n      updateTable();\n    });\n\n    document.getElementById('toggleFBlock').addEventListener('click', function() {\n      isCollapsed = !isCollapsed;\n      this.textContent = isCollapsed ? \"Ανάπτυξε\" : \"Σύμπτυξε\";\n      currentMode = isCollapsed ? \"collapsed\" : \"expanded\";\n      initializeBackgroundCanvas();\n      initializeSectorsCanvas();\n      [\"S\", \"D\", \"P\"].forEach(sector => {\n        let sectorCanvas = document.getElementById(\"canvas\" + sector);\n        let groupCanvas = document.getElementById(\"canvas\" + sector + \"_groups\");\n        if(sectorCanvas && groupCanvas) {\n          groupCanvas.style.left = sectorCanvas.style.left;\n          groupCanvas.style.top = (parseInt(positions[currentMode][\"1\"].y) - 42 - 2) + \"px\";\n        }\n      });\n    });\n\n    document.getElementById('reset').addEventListener('click', function() {\n      location.reload();\n    });\n\n    window.addEventListener('load', loadData);\n  </script>
</body>
</html>
