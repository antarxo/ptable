<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <title>Διαδραστική κατασκευή του Περιοδικού Πίνακα - Full Mode</title>
  <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
  <style>
    :root { --rightPanelWidth: 150px; }
    body {
      font-family: 'Roboto', sans-serif;
      margin: 0;
      overflow: hidden;
      background: #f7f7f7;
    }
    /* Τίτλος */
    #title {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 24px;
      font-weight: bold;
      z-index: 50;
    }
    /* Πίνακας πληροφοριών */
    #infoPanel {
      display: flex;
      flex-direction: row;
      background: rgba(255,255,255,0.95);
      border: 2px solid #333;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      padding: 20px;
      position: absolute;
      left: 20px;
      top: 428px;
      width: calc(100vw - var(--rightPanelWidth) - 105px);
      z-index: 40;
      transition: all 1.5s ease;
      text-align: left;
    }
    /* Σε collapsed mode αλλάζει διάταξη */
    body.collapsed #infoPanel {
      left: 848px;
      top: 112px;
      width: calc(100vw - 920px);
      flex-direction: column;
    }
    /* Left column (αρχική διάταξη) */
    #leftPanel {
      width: 220px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      text-align: left;
    }
    /* Right column (αρχική διάταξη) */
    #remarks { 
      flex-grow: 1; 
      padding-left: 20px; 
      text-align: left;
    }
    .right-wrapper { display: flex; flex-direction: column; }
    .upper-right { display: flex; flex-direction: row; }
    .subshells-col { width: auto; text-align: left; }
    .shells-msg-col { width: auto; text-align: left; margin-left: 20px; }
    /* Containers για τους καμβάδες τοποθετούνται εδώ */
    #canvasContainer {
      position: absolute;
      top: 100px;
      left: 50px;
      width: 800px;
      height: 400px;
      z-index: 10;
    }
    /* Κάθε container για καμβά ανά block */
    .canvasDiv {
      position: absolute;
      /* Οι αρχικές θέσεις μπορείς να τις προσαρμόσεις αναλόγως της διάταξης */
    }
    /* Για full mode οι θέσεις (παράδειγμα) */
    #canvasS { top: 120px; left: 50px; }
    #canvasF { top: 120px; left: 134px; width: 588px; }
    #canvasD { top: 120px; left: 134px; width: 420px; }
    #canvasP { top: 120px; left: 134px; width: 252px; }
    /* Balloon */
    #canvasSubshells {
      position: absolute;
      background: rgba(255,255,255,0.8);
      border: 1px solid #333;
      border-radius: 10px;
      box-shadow: 2px 2px 8px rgba(0,0,0,0.3);
      padding: 10px;
      z-index: 150;
      display: none;
    }
    /* Κουμπιά */
    #buttonPanel {
      position: fixed;
      bottom: 20px;
      right: 20px;
      display: flex;
      flex-direction: column;
      gap: 5px;
      z-index: 200;
    }
    button {
      background-color: #008CBA;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1em;
    }
    button:hover { background-color: #005f75; }
  </style>
</head>
<body class="full">
  <div id="title">Διαδραστική κατασκευή του Περιοδικού Πίνακα</div>
  
  <!-- Containers για τους καμβάδες (Full Mode) -->
  <div id="canvasContainer">
    <div id="canvasS" class="canvasDiv"></div>
    <div id="canvasF" class="canvasDiv"></div>
    <div id="canvasD" class="canvasDiv"></div>
    <div id="canvasP" class="canvasDiv"></div>
  </div>
  
  <!-- Πίνακας Πληροφοριών -->
  <div id="infoPanel">
    <div id="leftPanel"></div>
    <div id="remarks"></div>
  </div>
  
  <!-- Balloon -->
  <div id="canvasSubshells" class="canvas"></div>
  
  <!-- Κουμπιά -->
  <div id="buttonPanel">
    <button id="nextElement">Επόμενο</button>
    <button id="toggleFBlock">Σύμπτυξη</button>
    <button id="reset">Reset</button>
  </div>
  
  <script>
    // Όλες οι συναρτήσεις τρέχουν μετά το DOMContentLoaded
    window.addEventListener('DOMContentLoaded', function() {
      
      // Δεδομένα (παράδειγμα)
      elements = [
        { number: "3", symbol: "Li", name: "Λίθιο", subshells: "2s", shells: "2,1", block: "s", col:"1", row:"1", remarks:"" },
        { number: "4", symbol: "Be", name: "Βηρύλλιο", subshells: "2s", shells: "2,2", block: "s", col:"2", row:"1", remarks:"" },
        { number: "5", symbol: "B",  name: "Βόριο",    subshells: "2p", shells: "2,3", block: "p", col:"3", row:"1", remarks:"" }
      ];
      
      // Βασικές μεταβλητές
      let currentZ = 3;
      let flashActive = false;
      let subshellsP = null;
      
      function convertClickedToCurrent(clickedZ) { return clickedZ; }
      
      function getBlockColor(b) {
        if(b === "dummy") return "gray";
        switch(b) {
          case "s": return "red";
          case "p": return "darkgreen";
          case "d": return "darkblue";
          case "f": return "orange";
          default: return "black";
        }
      }
      
      function formatShells(shellsStr) {
        if(!shellsStr) return "";
        let shellNumbers = shellsStr.split(",").map(s => s.trim());
        const labels = ["K", "L", "M", "N", "O", "P", "Q"];
        return shellNumbers.map((s, i) => (i === shellNumbers.length - 1 ? `<strong>${labels[i]}(${s})</strong>` : `${labels[i]}(${s})`)).join(", ");
      }
      
      function messageForElement(element) {
        return "Μήνυμα δοκιμής";
      }
      
      function updateInfo(clickedZ) {
        let currentNum;
        if(clickedZ === 119) { currentNum = 1; }
        else if(clickedZ === 120) { currentNum = 2; }
        else { currentNum = convertClickedToCurrent(clickedZ); }
        
        const element = elements.find(e => Number(e.number) === Number(currentNum));
        if(!element) return;
        
        let displayZ = Number(element.number) >= 119 ? Number(element.number) - 118 : Number(element.number);
        if(clickedZ === 119) { displayZ = 1; }
        else if(clickedZ === 120) { displayZ = 2; }
        
        const infoHTML = `<span style="font-size:1.3em; font-weight:bold; color:black;">Ζ=${displayZ}</span> ` +
                         `<span style="font-size:3em; font-weight:bold; color:${getBlockColor(element.block)};">${element.symbol}</span> ` +
                         `<span style="font-style: italic;">${element.name}</span>`;
        document.getElementById('leftPanel').innerHTML = infoHTML;
        
        const prev = elements.find(e => Number(e.number) === (Number(currentNum) - 1)) || { subshells: "-", number:"", block:"dummy" };
        const next = elements.find(e => Number(e.number) === (Number(currentNum) + 1)) || { subshells: "-", number:"", block:"dummy" };
        
        const prevStr = `<div style="color:${getBlockColor(prev.block)};">Ζ=${(prev.subshells === "-") ? "-" : (prev.number + " " + prev.subshells)}</div>`;
        const currentStr = `<div style="font-weight:bold; color:${getBlockColor(element.block)};">Ζ=${element.number} ${element.subshells}</div>`;
        const nextStr = `<div style="color:${getBlockColor(next.block)};">Ζ=${next.number || ""} ${next.subshells}</div>`;
        const shellsAndMsg = `<div><strong>Στιβάδες:</strong> ${formatShells(element.shells)}</div>` +
                              `<div style="font-style: italic;">${messageForElement(element)}</div>`;
        
        // Διατάσσουμε τα στοιχεία στον πίνακα πληροφοριών (full mode)
        document.getElementById('remarks').innerHTML = `<div class="right-wrapper">
          <div class="upper-right">
            <div class="subshells-col">${prevStr}${currentStr}${nextStr}</div>
            <div class="shells-msg-col">${shellsAndMsg}</div>
          </div>
        </div>`;
        
        const subshellsData = {
          prev: prev.subshells,
          current: element.subshells,
          next: next.subshells,
          prevColor: getBlockColor(prev.block),
          currentColor: getBlockColor(element.block),
          nextColor: getBlockColor(next.block)
        };
        drawSubshells(subshellsData);
        setTimeout(() => { updateBalloonPosition(element); }, 10);
      }
      
      function updateBalloonPosition(element) {
        if(!element) return;
        const blockCanvas = document.getElementById("canvas" + element.block.toUpperCase());
        if(!blockCanvas) return;
        const rect = blockCanvas.getBoundingClientRect();
        const pos = calculatePosition(element, element.block);
        const cs = document.getElementById('canvasSubshells');
        if(cs) {
          let defaultLeft = rect.left + pos.x + 40;
          let defaultTop = rect.top + pos.y + 40;
          let leftPos = defaultLeft - 5;
          let topPos = defaultTop;
          const balloonWidth = cs.offsetWidth;
          const balloonHeight = cs.offsetHeight;
          if(defaultLeft > window.innerWidth / 2) {
            leftPos = defaultLeft - (33 + balloonWidth);
          }
          const infoPanel = document.getElementById('infoPanel');
          if(infoPanel) {
            const infoRect = infoPanel.getBoundingClientRect();
            if(defaultTop + balloonHeight > infoRect.top) {
              topPos = defaultTop - (27 + balloonHeight);
            }
          }
          if(leftPos + balloonWidth > window.innerWidth) {
            leftPos = window.innerWidth - balloonWidth - 5;
          }
          cs.style.display = "block";
          cs.style.left = leftPos + "px";
          cs.style.top = topPos + "px";
        }
      }
      
      function calculatePosition(e, block) {
        let x = 0, y = (e.row - 1) * 42;
        if(block === 's') { x = (e.col - 1) * 42; }
        else if(block === 'f') { x = (e.col - 3) * 42; }
        else if(block === 'd') { x = (e.col - 3) * 42; }
        else if(block === 'p') {
          if(currentZ < 20 && e.row === 1) { x = (e.col - 18) * 42; }
          else { x = (e.col - 13) * 42; }
        }
        return { x: x, y: y };
      }
      
      function drawSubshells(data) {
        if (!subshellsP) return;
        const balloonHeight = 40;
        const fontSize = 14;
        const leftMargin = 2;
        const extraMargin = 5;
        subshellsP.clear();
        subshellsP.textSize(fontSize);
        subshellsP.textAlign(subshellsP.LEFT, subshellsP.CENTER);
        const wPrev = subshellsP.textWidth(data.prev || "-");
        const wCurrent = subshellsP.textWidth(data.current || "-");
        const wNext = subshellsP.textWidth(data.next || "-");
        const computedWidth = Math.max(wPrev, wCurrent, wNext) + extraMargin;
        const newWidth = Math.max(computedWidth, 10);
        subshellsP.resizeCanvas(newWidth, balloonHeight);
        subshellsP.canvas.style.cssText = 'width: ' + newWidth + 'px !important; height: ' + balloonHeight + 'px !important;';
        const rowHeight = balloonHeight / 3;
        subshellsP.textStyle(p5.prototype.NORMAL);
        subshellsP.fill(data.prevColor || "black");
        subshellsP.text(data.prev || "-", leftMargin, rowHeight/2);
        subshellsP.textStyle(p5.prototype.BOLD);
        subshellsP.fill(data.currentColor || "black");
        subshellsP.text(data.current || "-", leftMargin, rowHeight + rowHeight/2);
        subshellsP.textStyle(p5.prototype.NORMAL);
        subshellsP.fill(data.nextColor || "black");
        subshellsP.text(data.next || "-", leftMargin, 2 * rowHeight + rowHeight/2);
      }
      
      function initializeCanvases() {
        // Δημιουργούμε έναν καμβά για κάθε block (S, F, D, P)
        ["S", "F", "D", "P"].forEach(block => {
          new p5(function(p) {
            p.setup = function() {
              const canvas = p.createCanvas(80, 80);
              const parentDiv = document.getElementById("canvas" + block);
              if(parentDiv) {
                canvas.parent(parentDiv);
              } else {
                console.error("Το div 'canvas" + block + "' δεν βρέθηκε στο DOM!");
              }
              p.background(200);
              p.fill(0);
              p.textAlign(p.CENTER, p.CENTER);
              p.textSize(16);
              p.text(block, 40, 40);
            };
          });
        });
      }
      
      function initSubshellsCanvas() {
        new p5(function(p) {
          p.setup = function() {
            const canvas = p.createCanvas(10, 40);
            const parentDiv = document.getElementById("canvasSubshells");
            if(parentDiv) {
              canvas.parent(parentDiv);
            }
            subshellsP = p;
            p.noLoop();
          };
        });
      }
      
      // Toggle handler: κρατάμε το τρέχον στοιχείο και μετά το toggle ενημερώνουμε το UI
      document.getElementById('toggleFBlock').addEventListener('click', function() {
        const previousZ = currentZ;
        document.body.classList.toggle('collapsed');
        const toggleBtn = document.getElementById('toggleFBlock');
        toggleBtn.textContent = document.body.classList.contains('collapsed') ? "Ανάπτυξη" : "Σύμπτυξη";
        requestAnimationFrame(() => {
          initializeCanvases();
          updateInfo(previousZ);
          updateBalloonPosition(elements.find(e => Number(e.number) === Number(previousZ)));
        });
      });
      
      document.getElementById('nextElement').addEventListener('click', function() {
        if(currentZ < elements.length) { currentZ++; }
        updateInfo(currentZ);
      });
      
      document.getElementById('reset').addEventListener('click', function() {
        currentZ = 3;
        initializeCanvases();
        initSubshellsCanvas();
        updateInfo(currentZ);
      });
      
      // Αρχική εκτέλεση
      initializeCanvases();
      initSubshellsCanvas();
      updateInfo(currentZ);
      
      window.updateInfo = updateInfo;
      window.initializeCanvases = initializeCanvases;
      window.updateBalloonPosition = updateBalloonPosition;
      
      window.addEventListener('resize', function() {
        updateInfo(currentZ);
      });
    });
  </script>
</body>
</html>
