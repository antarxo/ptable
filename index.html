<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <title>Πίνακας με Δύο Καμβάδες</title>
  <!-- Χρήση της γραμματοσειράς Roboto από Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Roboto', Arial, sans-serif;
      margin: 0;
      overflow: hidden;
      background: #f7f7f7;
    }
    /* Containers για τους δύο καμβάδες */
    #mainCanvasContainer {
      position: absolute;
      top: 0;
      left: 0;
      z-index: 1; /* κύριος καμβάς */
    }
    #overlayCanvasContainer {
      position: absolute;
      top: 0;
      left: 0;
      z-index: 10; /* overlay πάνω από τον κύριο */
      /* Εάν θέλετε το overlay να μην παρεμβαίνει στα clicks: */
      pointer-events: none;
    }
    /* Πάνελ πληροφοριών και κουμπιά (μπορείτε να τα ενσωματώσετε όπως στο αρχικό σας layout) */
    #infoPanel {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 10px;
      background: rgba(255,255,255,0.9);
      border: 1px solid #333;
      z-index: 20;
    }
    /* Παραδείγματος χάριν ορισμός κουμπιών */
    #controls {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 20;
    }
    #controls button {
      margin: 0 5px;
      padding: 5px 10px;
    }
  </style>
  <!-- Φόρτωση p5.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
</head>
<body>
  <!-- Πάνελ πληροφοριών -->
  <div id="infoPanel">Πληροφορίες στοιχείου...</div>
  <!-- Κουμπιά ελέγχου (μπορείτε να τα προσαρμόσετε) -->
  <div id="controls">
    <button id="nextElement">Επόμενο</button>
    <button id="fillAll">Συμπλήρωσε</button>
    <button id="togglePanel">Εναλλαγή collapsed</button>
    <button id="reset">Reset</button>
  </div>
  <!-- Containers για τους δύο καμβάδες -->
  <div id="mainCanvasContainer"></div>
  <div id="overlayCanvasContainer"></div>
  
  <script>
    /* --- Global Variables και Functions για τον πίνακα --- */
    let elementsData = [];  // Αν φορτώνετε elements.json, εδώ γίνεται η φόρτωση.
    let rowsData = [];
    let globalElementNumber = 3;
    let currentRowIndex = 3;
    let phase = 1;
    // hideFBlock: false = πλήρης πίνακας, true = collapsed mode (μόνο s στον κύριο, overlay για d/p και f)
    let hideFBlock = false;
    const colGap = 42;
    
    // Παράδειγμα initialize (τον προσαρμόζετε σύμφωνα με τον κώδικα σας)
    function initialize() {
      rowsData = [];
      for (let i = 0; i < 9; i++) {
        // Οι πρώτες 2 σειρές (ομάδες) θα έχουν 32 κελιά (για παράδειγμα)
        let cells = (i < 2) ? new Array(32).fill(null) : [];
        rowsData.push({
          cells: cells,
          shiftedColumns: 0,
          currentSegment: 0,
          countInSegment: 0,
          insertionIndex: 0,
          periodLabel: null
        });
      }
      // Εδώ θα πρέπει να ενσωματώσετε τον δικό σας κώδικα δημιουργίας του πίνακα.
      // Για παράδειγμα, για τις σειρές 3 έως 8:
      for (let i = 3; i < 9; i++) {
        let numCells = 18; // π.χ. 18 κελιά
        rowsData[i].cells = [];
        for (let j = 0; j < numCells; j++) {
          let num = 3 + i * 10 + j;
          // Προσαρμόστε τις κατηγορίες σύμφωνα με τον κώδικά σας:
          let cat = (j < 2) ? 's-block' : (j < 10) ? 'p-block' : (j < 14) ? 'd-block' : 'f-block';
          // Χρώματα από το αρχικό σας:
          let color;
          if (cat === 's-block') color = '#ffcccc';
          else if (cat === 'p-block') color = '#ccffcc';
          else if (cat === 'd-block') color = '#ccccff';
          else if (cat === 'f-block') color = '#ffe5cc';
          rowsData[i].cells.push({ number: num, category: cat, color: color });
        }
      }
      // Ορισμός period labels (προσαρμόστε όπως στον κώδικά σας)
      rowsData[2].periodLabel = "1η Κ";
      rowsData[3].periodLabel = "2η L";
      rowsData[4].periodLabel = "3η M";
      rowsData[5].periodLabel = "4η N";
      rowsData[6].periodLabel = "5η O";
      rowsData[7].periodLabel = "6η P";
      rowsData[8].periodLabel = "7η Q";
    }
    
    // Δείγμα updateInfoPanel – προσαρμόστε με τον κώδικά σας:
    function updateInfoPanel(cell) {
      let infoPanel = document.getElementById('infoPanel');
      if(cell) {
        infoPanel.innerHTML = `<strong>${cell.number}</strong> [${cell.category}]`;
      } else {
        infoPanel.innerHTML = "Πληροφορίες στοιχείου...";
      }
    }
    
    function clearInfoPanel() {
      document.getElementById('infoPanel').innerHTML = "Πληροφορίες στοιχείου...";
    }
    
    function handleMouseClick(x, y) {
      // Ελέγχουμε όλα τα κελιά από όλους τους πίνακες (αν έχουν ενημερωθεί οι drawX/drawY)
      let found = false;
      for(let rowIndex = 0; rowIndex < rowsData.length; rowIndex++){
        let row = rowsData[rowIndex];
        for(let i = 0; i < row.cells.length; i++){
          let cell = row.cells[i];
          if(cell && x >= cell.drawX && x <= cell.drawX + cell.drawW &&
             y >= cell.drawY && y <= cell.drawY + cell.drawH) {
            updateInfoPanel(cell);
            found = true;
            break;
          }
        }
        if(found) break;
      }
      if(!found) clearInfoPanel();
    }
    
    /* --- Συναρτήσεις Σχεδίασης --- */
    
    // Σχεδιάζει ολόκληρο τον πίνακα (full view)
    function drawFullTableMain(p) {
      p.background(247);
      let yOffset = 80;
      const groupRowsGap = 20;
      const normalGap = 42;
      for(let rowIndex = 0; rowIndex < rowsData.length; rowIndex++){
        let row = rowsData[rowIndex];
        let xOffset = 80;
        let cellsToDraw = row.cells;
        if(rowIndex < 2){
          p.noStroke();
          for(let i = 0; i < cellsToDraw.length; i++){
            let cell = cellsToDraw[i];
            if(cell){
              p.fill(cell.color);
              p.rect(xOffset, yOffset, 40, (cell.category==='group-name'?20:40));
              p.fill(0);
              p.textSize(12);
              p.textAlign(p.CENTER, p.CENTER);
              p.text(cell.number, xOffset+20, yOffset+(cell.category==='group-name'?10:20));
              // Αποθήκευση συντεταγμένων για interactivity
              cell.drawX = xOffset;
              cell.drawY = yOffset;
              cell.drawW = 40;
              cell.drawH = (cell.category==='group-name'?20:40);
            }
            xOffset += colGap;
          }
          p.stroke(85);
        } else {
          if(row.periodLabel){
            p.fill(0);
            p.textSize(12);
            p.textAlign(p.CENTER, p.CENTER);
            p.text(row.periodLabel, 45, yOffset+20);
          }
          xOffset = 80;
          for(let i = 0; i < cellsToDraw.length; i++){
            let cell = cellsToDraw[i];
            if(cell){
              p.fill(cell.color);
              p.stroke(85);
              p.rect(xOffset, yOffset, 40, (cell.category==='group-name'?20:40),5);
              p.fill(0);
              p.textSize(12);
              p.textAlign(p.CENTER, p.CENTER);
              p.text(cell.number, xOffset+20, yOffset+(cell.category==='group-name'?10:20));
              cell.drawX = xOffset;
              cell.drawY = yOffset;
              cell.drawW = 40;
              cell.drawH = (cell.category==='group-name'?20:40);
            }
            xOffset += colGap;
          }
        }
        yOffset += (rowIndex<2?groupRowsGap:normalGap);
      }
    }
    
    // Σχεδιάζει τον πίνακα collapsed: μόνο τα 2 πρώτα κελιά (s τομέας)
    function drawCollapsedTableMain(p) {
      p.background(247);
      let yOffset = 80;
      const groupRowsGap = 20;
      const normalGap = 42;
      for(let rowIndex = 0; rowIndex < rowsData.length; rowIndex++){
        let row = rowsData[rowIndex];
        let xOffset = 80;
        let cellsToDraw = row.cells.slice(0,2);
        if(rowIndex < 2){
          p.noStroke();
          for(let i = 0; i < cellsToDraw.length; i++){
            let cell = cellsToDraw[i];
            if(cell){
              p.fill(cell.color);
              p.rect(xOffset, yOffset, 40, (cell.category==='group-name'?20:40));
              p.fill(0);
              p.textSize(12);
              p.textAlign(p.CENTER, p.CENTER);
              p.text(cell.number, xOffset+20, yOffset+(cell.category==='group-name'?10:20));
              cell.drawX = xOffset;
              cell.drawY = yOffset;
              cell.drawW = 40;
              cell.drawH = (cell.category==='group-name'?20:40);
            }
            xOffset += colGap;
          }
          p.stroke(85);
        } else {
          if(row.periodLabel){
            p.fill(0);
            p.textSize(12);
            p.textAlign(p.CENTER, p.CENTER);
            p.text(row.periodLabel, 45, yOffset+20);
          }
          xOffset = 80;
          for(let i = 0; i < cellsToDraw.length; i++){
            let cell = cellsToDraw[i];
            if(cell){
              p.fill(cell.color);
              p.stroke(85);
              p.rect(xOffset, yOffset, 40, (cell.category==='group-name'?20:40),5);
              p.fill(0);
              p.textSize(12);
              p.textAlign(p.CENTER, p.CENTER);
              p.text(cell.number, xOffset+20, yOffset+(cell.category==='group-name'?10:20));
              cell.drawX = xOffset;
              cell.drawY = yOffset;
              cell.drawW = 40;
              cell.drawH = (cell.category==='group-name'?20:40);
            }
            xOffset += colGap;
          }
        }
        yOffset += (rowIndex<2?groupRowsGap:normalGap);
      }
    }
    
    // Σχεδιάζει το overlay για τους τομείς d και p (και τον μετατοπισμένο f) – θα καλείται μόνο σε collapsed mode
    function drawOverlay(p) {
      // Overlay για τους τομείς d και p: σχεδιάζονται όλα τα κελιά από index 2
      let yOverlay = 80;
      const groupRowsGap = 20;
      const normalGap = 42;
      for(let rowIndex = 0; rowIndex < rowsData.length; rowIndex++){
        let row = rowsData[rowIndex];
        if(row.cells.length > 2){
          let dpCells = row.cells.slice(2);
          for(let i = 0; i < dpCells.length; i++){
            let cell = dpCells[i];
            if(cell){
              // Ξεκινάμε μετά τον s τομέα: 80 + 2*colGap + 5px διάκενο
              let x = 80 + (i+2)*colGap + 5;
              let y = yOverlay;
              p.fill(cell.color);
              p.stroke(85);
              p.rect(x, y, 40, (cell.category==='group-name'?20:40),5);
              p.fill(0);
              p.textSize(12);
              p.textAlign(p.CENTER, p.CENTER);
              p.text(cell.number, x+20, y+(cell.category==='group-name'?10:20));
              cell.drawX = x;
              cell.drawY = y;
              cell.drawW = 40;
              cell.drawH = (cell.category==='group-name'?20:40);
            }
          }
        }
        yOverlay += (rowIndex<2?groupRowsGap:normalGap);
      }
      // Overlay για τον f τομέα: μετατοπισμένος προς τα κάτω (π.χ. +42px)
      let fCells = [];
      for(let r = 0; r < rowsData.length; r++){
        for(let i = 0; i < rowsData[r].cells.length; i++){
          let cell = rowsData[r].cells[i];
          if(cell && cell.category === 'f-block'){
            fCells.push(cell);
          }
        }
      }
      // Απλή ταξινόμηση με βάση τον αριθμό
      fCells.sort((a, b) => a.number - b.number);
      let lanthanides = fCells.filter(cell => cell.number >= 57 && cell.number <= 70);
      let actinides = fCells.filter(cell => cell.number >= 89 && cell.number <= 102);
      let startX = 80 + 84; 
      let startY = 450 + 42; // μετατόπιση collapsed
      for(let i = 0; i < lanthanides.length; i++){
        let cell = lanthanides[i];
        let x = startX + i * colGap;
        let y = startY;
        p.fill(cell.color);
        p.stroke(85);
        p.rect(x, y, 40, 40, 5);
        p.fill(0);
        p.textSize(12);
        p.textAlign(p.CENTER, p.CENTER);
        p.text(cell.number, x+20, y+20);
        cell.drawX = x;
        cell.drawY = y;
        cell.drawW = 40;
        cell.drawH = 40;
      }
      let fHeight = 40;
      let actinidesY = startY + fHeight + 2;
      for(let i = 0; i < actinides.length; i++){
        let cell = actinides[i];
        let x = startX + i * colGap;
        let y = actinidesY;
        p.fill(cell.color);
        p.stroke(85);
        p.rect(x, y, 40, 40, 5);
        p.fill(0);
        p.textSize(12);
        p.textAlign(p.CENTER, p.CENTER);
        p.text(cell.number, x+20, y+20);
        cell.drawX = x;
        cell.drawY = y;
        cell.drawW = 40;
        cell.drawH = 40;
      }
    }
    
    /* --- Δύο ξεχωριστοί p5 sketches --- */
    
    // Sketch για τον κύριο πίνακα (base)
    let mainSketch = function(p) {
      p.setup = function() {
        p.createCanvas(p.windowWidth, p.windowHeight);
        p.noLoop();
      };
      p.draw = function() {
        if (hideFBlock) {
          drawCollapsedTableMain(p);
        } else {
          drawFullTableMain(p);
        }
      };
      p.mouseClicked = function() {
        // Μεταβιβάζουμε τα events στο handleMouseClick
        handleMouseClick(p.mouseX, p.mouseY);
      };
      p.windowResized = function() {
        p.resizeCanvas(p.windowWidth, p.windowHeight);
        p.redraw();
      };
    };
    
    // Sketch για το overlay
    let overlaySketch = function(p) {
      p.setup = function() {
        p.createCanvas(p.windowWidth, p.windowHeight);
        p.clear();
        p.noLoop();
      };
      p.draw = function() {
        if (hideFBlock) {
          drawOverlay(p);
        } else {
          p.clear();
        }
      };
      p.windowResized = function() {
        p.resizeCanvas(p.windowWidth, p.windowHeight);
        p.redraw();
      };
    };
    
    // Αρχικοποίηση δεδομένων
    initialize();
    
    // Δημιουργούμε τα δύο sketches στα αντίστοιχα containers
    let mainP5 = new p5(mainSketch, 'mainCanvasContainer');
    let overlayP5 = new p5(overlaySketch, 'overlayCanvasContainer');
    
    // Παράδειγμα χειρισμού κουμπιών:
    document.getElementById('nextElement').addEventListener('click', function(e) {
      // Εδώ θα καλέσετε τη λειτουργία που προσθέτει το επόμενο στοιχείο στον πίνακα
      // addElementToCurrentRow();
      // Μετά ανανεώνουμε και τα δύο sketches:
      mainP5.redraw();
      overlayP5.redraw();
    });
    document.getElementById('fillAll').addEventListener('click', function(e) {
      // Εδώ θα καλείται μια λειτουργία που συμπληρώνει όλο τον πίνακα
      // while(phase < 6 || (phase === 1 && globalElementNumber <= 118)) { addElementToCurrentRow(); }
      mainP5.redraw();
      overlayP5.redraw();
    });
    document.getElementById('reset').addEventListener('click', function(e) {
      initialize();
      mainP5.redraw();
      overlayP5.redraw();
    });
    document.getElementById('togglePanel').addEventListener('click', function(e) {
      hideFBlock = !hideFBlock;
      // Ενημέρωση διαστάσεων αν χρειάζεται
      mainP5.redraw();
      overlayP5.redraw();
    });
  </script>
</body>
</html>
