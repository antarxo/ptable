<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <title>Πίνακας με 4 Καμβάδες - Λογική Συμπλήρωσης</title>
  <!-- Χρήση της γραμματοσειράς Roboto -->
  <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Roboto', Arial, sans-serif;
      margin: 0;
      overflow: hidden;
      background: #f7f7f7;
    }
    /* Πάνελ πληροφοριών και κουμπιά ελέγχου */
    #infoPanel {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 10px;
      background: rgba(255,255,255,0.95);
      border: 1px solid #333;
      z-index: 50;
    }
    #controls {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 50;
    }
    #controls button {
      margin: 0 5px;
      padding: 5px 10px;
    }
    /* Full mode: τοποθέτηση καμβάδων οριζόντια στη σειρά */
    .full #canvasS { top: 100px; left: 50px; width: 124px; height: 336px; z-index: 2; }
    .full #canvasF { top: 100px; left: 174px; width: 586px; height: 336px; z-index: 2; }
    .full #canvasD { top: 100px; left: 760px; width: 418px; height: 336px; z-index: 2; }
    .full #canvasP { top: 100px; left: 1178px; width: 250px; height: 336px; z-index: 2; }
    /* Collapsed mode: S, D, P παραμένουν στην πρώτη σειρά, ο F μετακινείται 100px προς τα κάτω */
    .collapsed #canvasS { top: 100px; left: 50px; width: 124px; height: 336px; z-index: 2; }
    .collapsed #canvasD { top: 100px; left: 174px; width: 418px; height: 336px; z-index: 2; }
    .collapsed #canvasP { top: 100px; left: 592px; width: 250px; height: 336px; z-index: 2; }
    .collapsed #canvasF { top: 200px; left: 174px; width: 586px; height: 336px; z-index: 1; }
    /* Βασικές ρυθμίσεις για όλους τους καμβάδες */
    #canvasS, #canvasF, #canvasD, #canvasP {
      position: absolute;
      border: 1px solid #ccc;
      background: #fff;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
</head>
<body class="full">
  <div id="infoPanel">Πληροφορίες στοιχείου...</div>
  <div id="controls">
    <button id="nextElement">Επόμενο</button>
    <button id="fillAll">Συμπλήρωσε</button>
    <button id="toggleMode">Εναλλαγή Mode</button>
    <button id="reset">Reset</button>
  </div>
  <!-- Containers για τους 4 καμβάδες -->
  <div id="canvasS"></div>
  <div id="canvasF"></div>
  <div id="canvasD"></div>
  <div id="canvasP"></div>
  
  <script>
    (function() {
      // Global μεταβλητές για τη λογική του πίνακα
      let elementsData = []; // Δεδομένα από elements.json (αν υπάρχουν)
      let rowsData = [];
      let globalElementNumber = 3;
      let currentRowIndex = 3; // 4η σειρά (index 3)
      let phase = 1;
      // mode: "full" ή "collapsed"
      let mode = "full";
      const colGap = 42;
      const fillingPatterns = [
        [{ count: 8, shifting: true }],
        [{ count: 8, shifting: false }],
        [{ count: 2, shifting: false }, { count: 10, shifting: true }, { count: 6, shifting: false }],
        [{ count: 2, shifting: false }, { count: 10, shifting: false }, { count: 6, shifting: false }],
        [{ count: 2, shifting: false }, { count: 14, shifting: true }, { count: 10, shifting: false }, { count: 6, shifting: false }],
        [{ count: 2, shifting: false }, { count: 14, shifting: false }, { count: 10, shifting: false }, { count: 6, shifting: false }]
      ];
      
      // Dummy δεδομένα για κάθε τομέα
      function generateData(columns, prefix) {
        const total = 9 * columns;
        let arr = [];
        for (let i = 0; i < total; i++) {
          arr.push({ number: i+1, symbol: prefix + (i+1) });
        }
        return arr;
      }
      let sData = generateData(3, "S");
      let fData = generateData(14, "F");
      let dData = generateData(10, "D");
      let pData = generateData(6, "P");
      
      // Συνάρτηση σχεδίασης grid: 9 σειρές (2 σειρές 20px, 7 σειρές 40px, gap 2px)
      function drawGrid(p, columns, dataArray) {
        let cellW = 40, gap = 2;
        let y = 0;
        let index = 0;
        for (let row = 0; row < 9; row++) {
          let cellH = (row < 2) ? 20 : 40;
          let x = 0;
          for (let col = 0; col < columns; col++) {
            let cell = dataArray[index] || { symbol: "" };
            p.fill(200,220,240);
            p.stroke(150);
            p.rect(x, y, cellW, cellH);
            p.fill(0);
            p.textSize(12);
            p.textAlign(p.CENTER, p.CENTER);
            p.text(cell.symbol, x + cellW/2, y + cellH/2);
            index++;
            x += cellW + gap;
          }
          y += cellH + gap;
        }
      }
      
      // P5 sketches για κάθε τομέα
      let sketchS = function(p) {
        p.setup = function() {
          p.createCanvas(124, 336);
          p.noLoop();
        };
        p.draw = function() {
          drawGrid(p, 3, sData);
        };
      };
      
      let sketchD = function(p) {
        p.setup = function() {
          p.createCanvas(418, 336);
          p.noLoop();
        };
        p.draw = function() {
          drawGrid(p, 10, dData);
        };
      };
      
      let sketchP = function(p) {
        p.setup = function() {
          p.createCanvas(250, 336);
          p.noLoop();
        };
        p.draw = function() {
          drawGrid(p, 6, pData);
        };
      };
      
      let sketchF = function(p) {
        p.setup = function() {
          p.createCanvas(586, 336);
          p.noLoop();
        };
        p.draw = function() {
          drawGrid(p, 14, fData);
        };
      };
      
      // Λογική συμπλήρωσης: Ξεκινάμε από τη δεύτερη στήλη της 4ης σειράς (row index 3, insertionIndex = 1)
      function initializeRows() {
        rowsData = [];
        for (let i = 0; i < 9; i++) {
          let cells = (i < 2) ? new Array(32).fill(null) : [];
          let insertionIndex = (i === 3) ? 1 : 0;
          rowsData.push({
            cells: cells,
            shiftedColumns: 0,
            currentSegment: 0,
            countInSegment: 0,
            insertionIndex: insertionIndex,
            periodLabel: null
          });
        }
        globalElementNumber = 3;
        currentRowIndex = 3;
        phase = 1;
      }
      
      function createCell(elObj) {
        let cell = {
          number: elObj.number,
          category: getCategory(elObj.number),
          width: 40,
          height: (getCategory(elObj.number) === 'group-name' ? 20 : 40),
          fixed: false
        };
        if (elementsData && elementsData.length >= elObj.number) {
          cell.details = elementsData[elObj.number - 1];
        }
        return cell;
      }
      
      function addElementToCurrentRow() {
        if (phase === 1) {
          if (globalElementNumber > 118) {
            currentRowIndex = 2;
            globalElementNumber = 1;
            phase = 2;
            redrawAll();
            return;
          }
          let row = rowsData[currentRowIndex];
          if (currentRowIndex >= 3 && currentRowIndex <= 8 && globalElementNumber <= 118) {
            let pattern = fillingPatterns[currentRowIndex - 3][row.currentSegment];
            let cell = createCell({ number: globalElementNumber });
            let targetIndex = row.insertionIndex;
            while (row.cells[targetIndex] != null) {
              targetIndex++;
              if (targetIndex >= row.cells.length) row.cells.push(null);
            }
            row.cells[targetIndex] = cell;
            globalElementNumber++;
            row.countInSegment++;
            if (row.countInSegment === pattern.count) {
              row.currentSegment++;
              row.countInSegment = 0;
              row.insertionIndex = row.cells.length;
            }
            if (row.currentSegment >= fillingPatterns[currentRowIndex - 3].length) {
              currentRowIndex++;
            }
            document.getElementById('infoPanel').innerHTML = `Προστέθηκε: ${cell.number}`;
          }
          redrawAll();
        }
      }
      
      function redrawAll() {
        sP5.redraw();
        dP5.redraw();
        pP5.redraw();
        fP5.redraw();
      }
      
      // Δημιουργία των 4 p5 instances
      let sP5 = new p5(sketchS, 'canvasS');
      let dP5 = new p5(sketchD, 'canvasD');
      let pP5 = new p5(sketchP, 'canvasP');
      let fP5 = new p5(sketchF, 'canvasF');
      
      // Event listeners για τα κουμπιά
      document.getElementById('nextElement').addEventListener('click', function() {
        addElementToCurrentRow();
      });
      document.getElementById('fillAll').addEventListener('click', function() {
        alert("Συμπλήρωση (δείγμα)");
      });
      document.getElementById('reset').addEventListener('click', function() {
        window.location.reload();
      });
      document.getElementById('toggleMode').addEventListener('click', function() {
        mode = (mode === "full") ? "collapsed" : "full";
        document.body.className = mode;
        if (mode === "collapsed") {
          document.getElementById('canvasF').style.top = "200px";
          document.getElementById('canvasF').style.zIndex = "1";
        } else {
          document.getElementById('canvasF').style.top = "";
          document.getElementById('canvasF').style.zIndex = "";
        }
        redrawAll();
      });
      
      window.addEventListener('resize', function() {
        redrawAll();
      });
      
      // Εκτέλεση αρχικής αρχικοποίησης
      initializeRows();
    })();
  </script>
</body>
</html>
