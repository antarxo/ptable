function initializeCanvases() {
  Object.keys(BLOCKS_CONFIG).forEach(function(block) {
    new p5(function(p) {
      p.setup = function() {
        const config = BLOCKS_CONFIG[block];
        const canvas = p.createCanvas(config.cols * 42, config.rows * 42);
        canvas.parent("canvas" + block.toUpperCase());
        canvas.elt.style.height = config.rows * 42 + "px";
        if(document.body.classList.contains('collapsed')){
          if(block === 's') { canvas.elt.style.left = "50px"; }
          else if(block === 'f' || block === 'd') { canvas.elt.style.left = (block === 'f' ? "154px" : "139px"); }
          else if(block === 'p') { canvas.elt.style.left = "559px"; }
        } else {
          if(block === 's') { canvas.elt.style.left = "50px"; }
          else if(block === 'f' || block === 'd' || block === 'p') { canvas.elt.style.left = "134px"; }
        }
        drawElements(p, block);
        p.mouseClicked = function() {
          console.log("MouseClicked on canvas block '" + block + "' at coordinates (" + p.mouseX + ", " + p.mouseY + "), currentZ:", currentZ);
          if(ignoreCanvasClick) {
            console.log("Ignoring click because ignoreCanvasClick is true.");
            return;
          }
          let candidates;
          if(currentZ < 118) {
            candidates = elements.filter(e => e.block === block && Number(e.number) >= 3 && Number(e.number) <= currentZ);
          } else if(currentZ === 118) {
            candidates = elements.filter(e => e.block === block && Number(e.number) >= 3 && Number(e.number) <= 118);
          } else if(currentZ === 119) {
            candidates = elements.filter(e => e.block === block && Number(e.number) === 1);
          } else if(currentZ === 120) {
            candidates = elements.filter(e => e.block === block && Number(e.number) === 2);
          } else {
            candidates = elements.filter(e => e.block === block && ((Number(e.number) >= 3 && Number(e.number) <= 118) || Number(e.number) === 1 || Number(e.number) === 2));
          }
          let candidateFound = false;
          for(let candidate of candidates) {
            let pos = calculatePosition(candidate, candidate.block);
            if(p.mouseX >= pos.x && p.mouseX <= pos.x + 40 &&
               p.mouseY >= pos.y && p.mouseY <= pos.y + 40) {
              console.log("Found candidate:", candidate.number, "at position:", pos);
              window.updateInfo(candidate.number);
              if(candidate.number === currentZ) {
                console.log("Candidate number equals currentZ. Activating flash.");
                flashActive = true;
                setTimeout(() => { flashActive = false; redrawAll(); }, 200);
              }
              candidateFound = true;
              break;
            }
          }
          if(!candidateFound) {
            console.log("No candidate found for click at (" + p.mouseX + ", " + p.mouseY + ") on block " + block);
          }
        };
      };
    });
  });
}
