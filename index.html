<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <title>Περιοδικός Πίνακας - F Τομέας Ευθυγραμμισμένος</title>
  <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
  <style>
    body { 
      font-family: 'Roboto', sans-serif; 
      margin: 0; 
      overflow: hidden; 
      background: #f7f7f7; 
    }
    .canvas { 
      position: absolute; 
      background: transparent; 
      transition: all 0.5s ease-in-out; 
    }
    canvas {
      padding: 8px;
      filter: drop-shadow(4px 4px 4px rgba(0,0,0,0.5));
      overflow: visible;
    }
    #canvasTableBackground {
      position: absolute; 
      background: white; 
      border: 1px solid rgba(0,0,0,0.1);
      box-shadow: 0 3px 3px rgba(0,0,0,0.2); 
      z-index: -10;
      opacity: 1;
    }
  </style>
</head>
<body>

  <!-- Καμβάδες -->
  <div id="canvasTableBackground"></div>
  <div id="canvasS_groups" class="canvas"></div>
  <div id="canvasD_groups" class="canvas"></div>
  <div id="canvasP_groups" class="canvas"></div>
  
  <div id="canvasPeriods" class="canvas"></div>
  <div id="canvasS" class="canvas"></div>
  <div id="canvasD" class="canvas"></div>
  <div id="canvasP" class="canvas"></div>
  <div id="canvasF" class="canvas"></div>

  <script>
    let elements = [];
    let positions = {};
    let currentMode = "expanded";

    async function loadData() {
      elements = await (await fetch('elements.json')).json();
      positions = await (await fetch('positions.json')).json();
      initializeSectorsCanvas();
      initGroupsCanvases();
    }

    function initializeSectorsCanvas() {
      // Υπολογισμός του δεξιού άκρου (maxX) του S block από το JSON
      let s_maxX = -Infinity;
      elements.filter(e => e.block === "s").forEach(e => {
        let pos = positions[currentMode][e.number];
        if(pos) {
          s_maxX = Math.max(s_maxX, pos.x + pos.width);
        }
      });

      let blocks = ["s", "p", "d", "f"];
      blocks.forEach(block => {
        let container = document.getElementById("canvas" + block.toUpperCase());
        container.innerHTML = "";
        let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;

        elements.filter(e => e.block === block).forEach(e => {
          let pos = positions[currentMode][e.number];
          if(pos) {
            minX = Math.min(minX, pos.x);
            minY = Math.min(minY, pos.y);
            maxX = Math.max(maxX, pos.x + pos.width);
            maxY = Math.max(maxY, pos.y + pos.height);
          }
        });

        if(minX === Infinity || minY === Infinity) return;

        // **Εφαρμογή Μετατόπισης του F block**
        if(block === "f") {
          container.style.left = s_maxX + "px";
        } else {
          container.style.left = minX + "px";
        }

        container.style.top = minY + "px";
        container.style.width = (maxX - minX) + "px";
        container.style.height = (maxY - minY) + "px";

        new p5(function(p) {
          p.setup = function() {
            let canvas = p.createCanvas(parseInt(container.style.width), parseInt(container.style.height));
            canvas.parent("canvas" + block.toUpperCase());
            drawElements(p, block, minX, minY);
          };
        });
      });
    }

    function drawElements(p, block, containerLeft, containerTop) {
      let colors = { s: "#FF477E", p: "#26FF31", d: "#3F99FF", f: "#FFD051" };
      elements.filter(e => e.block === block).forEach(e => {
        let pos = positions[currentMode][e.number];
        if(pos){
          let relativeX = pos.x - containerLeft;
          let relativeY = pos.y - containerTop;
          p.fill(colors[block] || "#CCCCCC");
          p.rect(relativeX, relativeY, pos.width, pos.height, 5);
          p.fill(0);
          p.textSize(13);
          p.textStyle(p.BOLD);
          p.textAlign(p.CENTER, p.CENTER);
          p.text(e.number, relativeX + pos.width/2, relativeY + pos.height/2);
        }
      });
    }

    function initGroupsCanvases() {
      ["S", "D", "P"].forEach(sector => {
        new p5(function(p) {
          let cols = sector === "S" ? 2 : sector === "D" ? 10 : 6;
          let canvasWidth = cols * 42 - 2;
          let canvas = p.createCanvas(canvasWidth, 40);
          canvas.parent("canvas" + sector + "_groups");
          p.background(240);
          p.fill(0);
          p.textAlign(p.CENTER, p.CENTER);
          p.textSize(11);
          p.textStyle(p.BOLD);

          for(let c = 0; c < cols; c++){
            let x = c * 42;
            p.text((sector === "S" ? c+1 : sector === "D" ? c+3 : c+13).toString(), x + 20, 10);
          }

          const oldLabels = {
            "S": ["IA", "IIA"],
            "D": ["IIIB","IVB","VB","VIB","VIIB","VIIIB","VIIIB","VIIIB","IB","IIB"],
            "P": ["IIIA","IVA","VA","VIA","VIIA","VIIIA"]
          };

          for(let c = 0; c < cols; c++){
            let x = c * 42;
            p.text(oldLabels[sector][c], x + 20, 30);
          }
        });

        let sectorCanvas = document.getElementById("canvas" + sector);
        let groupCanvas = document.getElementById("canvas" + sector + "_groups");
        groupCanvas.style.left = sectorCanvas.style.left;
        groupCanvas.style.top = (parseInt(positions[currentMode]["1"].y) - 42) + "px";
      });
    }

    window.addEventListener('load', loadData);
  </script>

</body>
</html>
