<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <title>Toggle Grouped Expanded/Collapsed</title>
  <!-- Φόρτωση της βιβλιοθήκης p5.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>
  <style>
    body { font-family: sans-serif; }
    #toggleButton { margin-bottom: 10px; }
  </style>
</head>
<body>
  <!-- Κουμπί εναλλαγής -->
  <button id="toggleButton">Εμφάνιση Expanded</button>
  <script>
    let positions; // το αρχικό JSON από το αρχείο
    let groupedExpanded, groupedCollapsed; // αντικείμενα μετά το grouping
    let showExpanded = true;  // αρχικά δείχνει expanded

    // Συνάρτηση ομαδοποίησης ανά κατάσταση με βάση τις γραμμές και τον αριθμό της στήλης
    function groupState(state) {
      // Αρχικοποιούμε τα blocks
      let grouped = { s: {}, f: {}, d: {}, p: {} };
      // Ομαδοποίηση κατά γραμμή (χρησιμοποιούμε την τιμή y ως κλειδί)
      let rows = {};
      for (let key in state) {
        let pos = state[key];
        let yKey = pos.y;  // υποθέτουμε ακριβείς τιμές για κάθε γραμμή
        if (!rows[yKey]) rows[yKey] = [];
        rows[yKey].push({ key: key, pos: pos });
      }
      // Για κάθε γραμμή, ταξινομούμε κατά x και αντιστοιχούμε την στήλη (column index)
      for (let y in rows) {
        let items = rows[y];
        items.sort((a, b) => a.pos.x - b.pos.x);
        for (let i = 0; i < items.length; i++) {
          let colIndex = i + 1; // column index ξεκινάει από 1
          let group;
          if (colIndex <= 2) group = "s";
          else if (colIndex <= 16) group = "f";
          else if (colIndex <= 26) group = "d";
          else if (colIndex <= 32) group = "p";
          // Εάν υπάρχουν περισσότερες στήλες, αγνοούμε τις επιπλέον
          if (group) {
            grouped[group][items[i].key] = items[i].pos;
          }
        }
      }
      return grouped;
    }

    // Φόρτωση του αρχείου JSON πριν από το setup
    function preload() {
      positions = loadJSON('positions.json');
    }

    function setup() {
      createCanvas(1400, 400);
      // Ομαδοποίηση για κάθε κατάσταση
      groupedExpanded = groupState(positions.expanded);
      groupedCollapsed = groupState(positions.collapsed);
      
      console.log("Grouped Expanded:", groupedExpanded);
      console.log("Grouped Collapsed:", groupedCollapsed);
      
      // Listener για το κουμπί εναλλαγής
      const btn = document.getElementById('toggleButton');
      btn.addEventListener('click', toggleState);
    }

    function draw() {
      background(240);
      // Εμφάνιση κατάστασης και ένδειξη πάνω στο canvas
      fill(0);
      textSize(16);
      if (showExpanded) {
        text("Expanded", 10, 20);
        drawGroupedPositions(groupedExpanded);
      } else {
        text("Collapsed", 10, 20);
        drawGroupedPositions(groupedCollapsed);
      }
    }

    // Συνάρτηση που σχεδιάζει τα ορθογώνια για κάθε block (s, f, d, p)
    function drawGroupedPositions(groupedData) {
      // Ορισμός διαφορετικών χρωμάτων για κάθε block για οπτική διάκριση
      const colors = { s: color(255, 100, 100), f: color(100, 255, 100), d: color(100, 100, 255), p: color(255, 255, 100) };
      for (let group in groupedData) {
        let groupItems = groupedData[group];
        for (let key in groupItems) {
          let pos = groupItems[key];
          fill(colors[group]);
          stroke(0);
          rect(pos.x, pos.y, pos.width, pos.height);
          // Εμφάνιση του key μέσα στο ορθογώνιο
          fill(0);
          noStroke();
          textSize(10);
          text(key, pos.x + 2, pos.y + 12);
        }
      }
    }

    // Εναλλαγή μεταξύ των καταστάσεων
    function toggleState() {
      showExpanded = !showExpanded;
      const btn = document.getElementById('toggleButton');
      btn.textContent = showExpanded ? "Εμφάνιση Expanded" : "Εμφάνιση Collapsed";
    }
  </script>
</body>
</html>
