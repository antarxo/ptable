<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <title>Î ÎµÏÎ¹Î¿Î´Î¹ÎºÏŒÏ‚ Î Î¯Î½Î±ÎºÎ±Ï‚ Î¼Îµ Î£Ï„Î±Î¸ÎµÏÎ­Ï‚ Î£Ï‡ÎµÏ„Î¹ÎºÎ­Ï‚ Î˜Î­ÏƒÎµÎ¹Ï‚</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; overflow: hidden; background: #f7f7f7; }
    .canvas { position: absolute; background: transparent; transition: all 0.5s ease-in-out; }
    #buttonPanel { position: fixed; bottom: 20px; right: 20px; z-index: 100; }
    #buttonPanel button { background-color: #008CBA; color: white; padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; }
  </style>
</head>
<body>

  <!-- ÎšÎ±Î¼Î²Î¬Î´ÎµÏ‚ -->
  <div id="canvasS" class="canvas"></div>
  <div id="canvasP" class="canvas"></div>
  <div id="canvasD" class="canvas"></div>
  <div id="canvasF" class="canvas"></div>

  <!-- ÎšÎ¿Ï…Î¼Ï€Î¯ Î³Î¹Î± ÏƒÏ…Î¼Ï€Î»Î®ÏÏ‰ÏƒÎ· -->
  <div id="buttonPanel">
    <button id="fillAll">Î£Ï…Î¼Ï€Î»Î®ÏÏ‰ÏƒÎµ</button>
  </div>

  <script>
    let elements = [];
    let positions = {};
    let blockOffsets = {}; // minX, minY Î³Î¹Î± ÎºÎ¬Î¸Îµ block (ÏƒÏ„Î±Î¸ÎµÏÏŒ Î¼ÎµÏ„Î¬ Ï„Î·Î½ Î±ÏÏ‡Î¹ÎºÎ® Ï†ÏŒÏÏ„Ï‰ÏƒÎ·)

    // ğŸ”¹ 1. Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½
    async function loadData() {
      elements = await (await fetch('elements.json')).json();
      positions = await (await fetch('positions.json')).json();
      
      computeBlockOffsets(); // Î£Ï„Î±Î¸ÎµÏÎ¿Ï€Î¿Î¹Î¿ÏÎ¼Îµ Ï„Î± offsets
      initializeCanvases();
    }

    // ğŸ”¹ 2. Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Ï„Ï‰Î½ minX, minY ÏƒÏ„Î±Î¸ÎµÏÎ¬ ÎºÎ±Ï„Î¬ Ï„Î·Î½ Ï€ÏÏÏ„Î· Ï†ÏŒÏÏ„Ï‰ÏƒÎ·
    function computeBlockOffsets() {
      ["s", "p", "d", "f"].forEach(block => {
        let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;
        Object.keys(positions.expanded).forEach(num => {
          let e = elements.find(el => el.number == num);
          if (e && e.block === block) {
            let pos = positions.expanded[num];
            minX = Math.min(minX, pos.x);
            minY = Math.min(minY, pos.y);
            maxX = Math.max(maxX, pos.x + pos.width);
            maxY = Math.max(maxY, pos.y + pos.height);
          }
        });
        blockOffsets[block] = { minX, minY, width: maxX - minX, height: maxY - minY };
        console.log(`ğŸ“Œ Block ${block} offsets:`, blockOffsets[block]);
      });
    }

    // ğŸ”¹ 3. Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ ÏƒÏ‡ÎµÏ„Î¹ÎºÏÎ½ Î¸Î­ÏƒÎµÏ‰Î½ ÎµÎ½Ï„ÏŒÏ‚ Ï„Î¿Ï… ÎºÎ±Î¼Î²Î¬
    function calculateRelativePosition(element, block) {
      let pos = positions.expanded[element.number];
      let offset = blockOffsets[block];
      return { x: pos.x - offset.minX, y: pos.y - offset.minY };
    }

    // ğŸ”¹ 4. Î‘ÏÏ‡Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· ÎºÎ±Î¼Î²Î¬Î´Ï‰Î½
    function initializeCanvases() {
      ["s", "p", "d", "f"].forEach(block => {
        let offset = blockOffsets[block];

        // Î”Î¹Î±Î³ÏÎ±Ï†Î® Ï…Ï€Î¬ÏÏ‡Î¿Î½Ï„Î¿Ï‚ Ï€ÎµÏÎ¹ÎµÏ‡Î¿Î¼Î­Î½Î¿Ï…
        let container = document.getElementById("canvas" + block.toUpperCase());
        container.innerHTML = "";

        new p5(function (p) {
          p.setup = function () {
            let canvas = p.createCanvas(offset.width, offset.height);
            canvas.parent("canvas" + block.toUpperCase());

            container.style.left = offset.minX + "px";
            container.style.top = offset.minY + "px";
            container.style.width = offset.width + "px";
            container.style.height = offset.height + "px";

            drawElements(p, block);
          };
        });
      });
    }

    // ğŸ”¹ 5. Î£Ï‡ÎµÎ´Î¯Î±ÏƒÎ· Ï„Ï‰Î½ ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Ï‰Î½ ÎµÎ½Ï„ÏŒÏ‚ Ï„Ï‰Î½ ÎºÎ±Î¼Î²Î¬Î´Ï‰Î½
    function drawElements(p, block) {
      elements.filter(e => e.block === block).forEach(e => {
        let pos = calculateRelativePosition(e, block);
        let color = { s: "#FF477E", p: "#26FF31", d: "#3F99FF", f: "#FFD051" }[block];

        console.log(`ğŸ¨ Î£Ï„Î¿Î¹Ï‡ÎµÎ¯Î¿ ${e.number} (${e.symbol}): Î£Ï‡ÎµÏ„Î¹ÎºÎ® Î¸Î­ÏƒÎ· x=${pos.x}, y=${pos.y}`);

        p.fill(color);
        p.rect(pos.x, pos.y, 40, 40, 5);
        p.fill(0);
        p.textSize(12);
        p.textAlign(p.CENTER, p.CENTER);
        p.text(e.symbol, pos.x + 20, pos.y + 20);
      });
    }

    // ğŸ”¹ 6. Î£Ï…Î¼Ï€Î»Î®ÏÏ‰ÏƒÎ· ÏŒÎ»Ï‰Î½ Ï„Ï‰Î½ ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Ï‰Î½
    document.getElementById('fillAll').addEventListener('click', function() {
      console.log("ğŸ”„ Î•Ï€Î±Î½Î±ÏƒÏ‡ÎµÎ´Î¯Î±ÏƒÎ· ÏŒÎ»Ï‰Î½ Ï„Ï‰Î½ ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Ï‰Î½...");
      initializeCanvases();
    });

    // ğŸ”¹ 7. Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ ÎºÎ±Ï„Î¬ Ï„Î·Î½ ÎµÎºÎºÎ¯Î½Î·ÏƒÎ·
    window.addEventListener('load', loadData);
  </script>

</body>
</html>
