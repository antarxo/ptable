<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <title>Διαδραστική κατασκευή του Περιοδικού Πίνακα</title>
    <link rel="icon" href="data:,">
    <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            overflow: hidden;
            background: #f7f7f7;
        }

        #title {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 24px;
            font-weight: bold;
            z-index: 50;
        }

        .canvas-container {
            position: absolute;
            border: 1px solid black;
            background: rgba(0, 255, 0, 0.1);
        }

        #buttonPanel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        button {
            background-color: #008CBA;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s;
        }

        button:hover { background-color: #005f75; }
    </style>
</head>
<body>
    <div id="title">Διαδραστική κατασκευή του Περιοδικού Πίνακα</div>

    <!-- Καμβάδες -->
    <div id="canvasS" class="canvas-container"></div>
    <div id="canvasF" class="canvas-container"></div>
    <div id="canvasD" class="canvas-container"></div>
    <div id="canvasP" class="canvas-container"></div>

    <!-- Κουμπιά -->
    <div id="buttonPanel">
        <button id="nextElement">Επόμενο</button>
        <button id="fillAll">Συμπλήρωσε</button>
        <button id="toggleFBlock">Σύμπτυξε</button>
    </div>

    <script>
        let positionsData = null;
        let elementsData = null;

        function loadPositions() {
            fetch('positions.json')
                .then(response => response.json())
                .then(data => {
                    positionsData = data;
                    console.log("Positions loaded:", positionsData);
                    updateSectors('expanded');
                })
                .catch(error => console.error('Σφάλμα φόρτωσης positions:', error));
        }

        function loadElements() {
            fetch('elements.json')
                .then(response => response.json())
                .then(data => {
                    elementsData = data;
                    console.log("Elements loaded:", elementsData);
                    redrawAll();
                })
                .catch(error => console.error('Σφάλμα φόρτωσης elements:', error));
        }

        function updateSectors(mode) {
            if (!positionsData) return;
            console.log("Updating sectors for mode:", mode);

            const canvasMapping = {
                'canvasS': '1',
                'canvasF': '2',
                'canvasD': '3',
                'canvasP': '4'
            };

            const modePositions = positionsData[mode];
            if (!modePositions) {
                console.error('Δεν βρέθηκαν θέσεις για το mode:', mode);
                return;
            }

            Object.entries(canvasMapping).forEach(([canvasId, posKey]) => {
                const pos = modePositions[posKey];
                const canvasEl = document.getElementById(canvasId);
                if (canvasEl && pos) {
                    canvasEl.style.left = pos.x + "px";
                    canvasEl.style.top = pos.y + "px";
                    canvasEl.style.width = pos.width + "px";
                    canvasEl.style.height = pos.height + "px";
                }
            });

            redrawAll();
        }

        function setup() {
            createCanvasInContainer("canvasS", "red");
            createCanvasInContainer("canvasF", "blue");
            createCanvasInContainer("canvasD", "green");
            createCanvasInContainer("canvasP", "purple");
        }

        function createCanvasInContainer(containerId, color) {
            let container = document.getElementById(containerId);
            if (!container) return;

            let canvas = createCanvas(container.offsetWidth, container.offsetHeight);
            canvas.parent(container);
            background(255);

            fill(color);
            textSize(16);
            textAlign(CENTER, CENTER);
            text(containerId, width / 2, height / 2);
        }

        function redrawAll() {
            if (!elementsData) return;
            console.log("Redrawing periodic table...");

            redrawCanvas("canvasS", "red");
            redrawCanvas("canvasF", "blue");
            redrawCanvas("canvasD", "green");
            redrawCanvas("canvasP", "purple");
        }

        function redrawCanvas(containerId, color) {
            let container = document.getElementById(containerId);
            if (!container) return;

            let canvas = select(`#${containerId} canvas`);
            if (!canvas) return;

            canvas.resizeCanvas(container.offsetWidth, container.offsetHeight);
            background(255);

            fill(color);
            textSize(20);
            textAlign(CENTER, CENTER);
            text(containerId, width / 2, height / 2);

            fill(0);
            textSize(14);
            let x = 20, y = 20;
            let count = 0;

            for (let el of elementsData) {
                rect(x, y, 40, 40);
                fill(255);
                text(el.symbol, x + 20, y + 20);
                x += 45;
                count++;
                if (count % 10 === 0) {
                    x = 20;
                    y += 50;
                }
            }
        }

        document.addEventListener("DOMContentLoaded", function () {
            loadPositions();
            loadElements();

            document.getElementById("nextElement").addEventListener("click", function () {
                updateSectors('expanded');
            });

            document.getElementById("fillAll").addEventListener("click", function () {
                updateSectors('expanded');
            });

            document.getElementById("toggleFBlock").addEventListener("click", function () {
                updateSectors('collapsed');
            });
        });
    </script>
</body>
</html>
