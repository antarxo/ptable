<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <title>Δύο Ξεχωριστοί Καμβάδες - Πίνακας και Overlay</title>
  <!-- Χρήση της γραμματοσειράς Roboto από Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Roboto', Arial, sans-serif;
      margin: 0;
      overflow: hidden;
      background: #f7f7f7;
    }
    /* Δύο containers για τους καμβάδες */
    #mainCanvasContainer {
      position: absolute;
      top: 0;
      left: 0;
      z-index: 1; /* κάτω επίπεδο */
    }
    #overlayCanvasContainer {
      position: absolute;
      top: 0;
      left: 0;
      z-index: 10; /* πάνω από τον κύριο */
      pointer-events: none; /* Αν θέλεις το overlay να μην παρεμβαίνει στα clicks */
    }
    /* Πάνελ πληροφοριών (δείχνουμε τον τίτλο εδώ για λόγους επίδειξης) */
    #infoPanel {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 10px;
      background: rgba(255,255,255,0.9);
      border: 1px solid #333;
      z-index: 20;
    }
  </style>
  <!-- Φόρτωση p5.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
</head>
<body>
  <div id="infoPanel">Παράδειγμα με δύο ξεχωριστούς καμβάδες</div>
  <!-- Containers για τους δύο καμβάδες -->
  <div id="mainCanvasContainer"></div>
  <div id="overlayCanvasContainer"></div>
  
  <script>
    /* Global variables και dummy data για παράδειγμα */
    let elementsData; // Αν υπάρχει JSON, εδώ θα το φορτώσεις
    let rowsData = [];
    const colGap = 42; // βασικό μέτρο και διάκενο
    // hideFBlock: true για collapsed mode (μόνο s στον κύριο πίνακα, overlay για d/p και f)
    let hideFBlock = true; 

    // Dummy initialization για το παράδειγμα:
    function initialize() {
      rowsData = [];
      for (let i = 0; i < 9; i++) {
        // Οι πρώτες 2 σειρές (ομάδες) θα έχουν 32 κελιά (για απλό παράδειγμα)
        let cells = (i < 2) ? new Array(32).fill(null) : [];
        rowsData.push({
          cells: cells,
          shiftedColumns: 0,
          currentSegment: 0,
          countInSegment: 0,
          insertionIndex: 0,
          periodLabel: null
        });
      }
      // Για τις υπόλοιπες σειρές, δημιουργούμε dummy κελιά.
      for (let i = 2; i < 9; i++) {
        let numCells = 18; // π.χ. 18 κελιά ανά σειρά
        rowsData[i].cells = [];
        for (let j = 0; j < numCells; j++) {
          // Δίνουμε ένα dummy αριθμό και κατηγορία
          let num = 3 + i * 10 + j;
          let cat = 's-block';
          if(j >= 2 && j < 10) cat = 'p-block';
          else if(j >= 10 && j < 14) cat = 'd-block';
          else if(j >= 14) cat = 'f-block';
          // Ορίζουμε ένα dummy χρώμα ανά κατηγορία
          let color;
          if(cat === 's-block') color = '#ffcccc';
          else if(cat === 'p-block') color = '#ccffcc';
          else if(cat === 'd-block') color = '#ccccff';
          else if(cat === 'f-block') color = '#ffe5cc';
          rowsData[i].cells.push({ number: num, category: cat, color: color });
        }
      }
      // Μπορούμε να ορίσουμε dummy period labels για τις σειρές μετά τη 2η:
      rowsData[2].periodLabel = "1η Κ";
      rowsData[3].periodLabel = "2η L";
      rowsData[4].periodLabel = "3η M";
      rowsData[5].periodLabel = "4η N";
      rowsData[6].periodLabel = "5η O";
      rowsData[7].periodLabel = "6η P";
      rowsData[8].periodLabel = "7η Q";
    }

    // Συναρτήσεις σχεδίασης για τον κύριο πίνακα (main canvas)
    function drawFullTableMain(p) {
      p.background(247);
      let yOffset = 80;
      const groupRowsGap = 20;
      const normalGap = 42;
      for (let rowIndex = 0; rowIndex < rowsData.length; rowIndex++) {
        let row = rowsData[rowIndex];
        let xOffset = 80;
        let cellsToDraw = row.cells;
        if (rowIndex < 2) {
          p.noStroke();
          for (let i = 0; i < cellsToDraw.length; i++) {
            let cell = cellsToDraw[i];
            if (cell) {
              p.fill(cell.color);
              p.rect(xOffset, yOffset, 40, (cell.category === 'group-name' ? 20 : 40));
              p.fill(0);
              p.textSize(12);
              p.textAlign(p.CENTER, p.CENTER);
              p.text(cell.number, xOffset + 20, yOffset + (cell.category === 'group-name' ? 10 : 20));
            }
            xOffset += colGap;
          }
          p.stroke(85);
        } else {
          if (row.periodLabel) {
            p.fill(0);
            p.textSize(12);
            p.textAlign(p.CENTER, p.CENTER);
            p.text(row.periodLabel, 45, yOffset + 20);
          }
          xOffset = 80;
          for (let i = 0; i < cellsToDraw.length; i++) {
            let cell = cellsToDraw[i];
            if (cell) {
              p.fill(cell.color);
              p.stroke(85);
              p.rect(xOffset, yOffset, 40, (cell.category === 'group-name' ? 20 : 40), 5);
              p.fill(0);
              p.textSize(12);
              p.textAlign(p.CENTER, p.CENTER);
              p.text(cell.number, xOffset + 20, yOffset + (cell.category === 'group-name' ? 10 : 20));
            }
            xOffset += colGap;
          }
        }
        yOffset += (rowIndex < 2 ? groupRowsGap : normalGap);
      }
    }

    function drawCollapsedTableMain(p) {
      // Σχεδιάζει μόνο τα 2 πρώτα κελιά (τον s τομέα)
      p.background(247);
      let yOffset = 80;
      const groupRowsGap = 20;
      const normalGap = 42;
      for (let rowIndex = 0; rowIndex < rowsData.length; rowIndex++) {
        let row = rowsData[rowIndex];
        let xOffset = 80;
        let cellsToDraw = row.cells.slice(0, 2);
        if (rowIndex < 2) {
          p.noStroke();
          for (let i = 0; i < cellsToDraw.length; i++) {
            let cell = cellsToDraw[i];
            if (cell) {
              p.fill(cell.color);
              p.rect(xOffset, yOffset, 40, (cell.category === 'group-name' ? 20 : 40));
              p.fill(0);
              p.textSize(12);
              p.textAlign(p.CENTER, p.CENTER);
              p.text(cell.number, xOffset + 20, yOffset + (cell.category === 'group-name' ? 10 : 20));
            }
            xOffset += colGap;
          }
          p.stroke(85);
        } else {
          if (row.periodLabel) {
            p.fill(0);
            p.textSize(12);
            p.textAlign(p.CENTER, p.CENTER);
            p.text(row.periodLabel, 45, yOffset + 20);
          }
          xOffset = 80;
          for (let i = 0; i < cellsToDraw.length; i++) {
            let cell = cellsToDraw[i];
            if (cell) {
              p.fill(cell.color);
              p.stroke(85);
              p.rect(xOffset, yOffset, 40, (cell.category === 'group-name' ? 20 : 40), 5);
              p.fill(0);
              p.textSize(12);
              p.textAlign(p.CENTER, p.CENTER);
              p.text(cell.number, xOffset + 20, yOffset + (cell.category === 'group-name' ? 10 : 20));
            }
            xOffset += colGap;
          }
        }
        yOffset += (rowIndex < 2 ? groupRowsGap : normalGap);
      }
    }

    // Συναρτήσεις σχεδίασης για το overlay (overlay canvas)
    function drawCollapsedOverlay(p) {
      // Overlay για τους τομείς d και p: σχεδιάζει όλα τα κελιά από index 2, ξεκινώντας δίπλα από τον s με διάκενο 5px.
      let yOverlay = 80;
      const groupRowsGap = 20;
      const normalGap = 42;
      for (let rowIndex = 0; rowIndex < rowsData.length; rowIndex++) {
        let row = rowsData[rowIndex];
        if (row.cells.length > 2) {
          let dpCells = row.cells.slice(2);
          for (let i = 0; i < dpCells.length; i++) {
            let cell = dpCells[i];
            if (cell) {
              let x = 80 + (i + 2) * colGap + 5; // πρόσθετο 5px διάκενο
              let y = yOverlay;
              p.fill(cell.color);
              p.stroke(85);
              p.rect(x, y, 40, (cell.category === 'group-name' ? 20 : 40), 5);
              p.fill(0);
              p.textSize(12);
              p.textAlign(p.CENTER, p.CENTER);
              p.text(cell.number, x + 20, y + (cell.category === 'group-name' ? 10 : 20));
            }
          }
        }
        yOverlay += (rowIndex < 2 ? groupRowsGap : normalGap);
      }
      // Overlay για τον f τομέα: μετατοπισμένος προς τα κάτω (π.χ. +42px)
      let fCells = [];
      for (let r = 0; r < rowsData.length; r++) {
        for (let i = 0; i < rowsData[r].cells.length; i++) {
          let cell = rowsData[r].cells[i];
          if (cell && cell.category === 'f-block') {
            fCells.push(cell);
          }
        }
      }
      // Ταξινόμηση με βάση τον αριθμό (dummy)
      fCells.sort((a, b) => a.number - b.number);
      let lanthanides = fCells.filter(cell => cell.number >= 57 && cell.number <= 70);
      let actinides = fCells.filter(cell => cell.number >= 89 && cell.number <= 102);
      let startX = 80 + 84;
      let startY = 450 + 42; // μετατόπιση όταν collapsed
      for (let i = 0; i < lanthanides.length; i++) {
        let cell = lanthanides[i];
        let x = startX + i * colGap;
        let y = startY;
        p.fill(cell.color);
        p.stroke(85);
        p.rect(x, y, 40, 40, 5);
        p.fill(0);
        p.textSize(12);
        p.textAlign(p.CENTER, p.CENTER);
        p.text(cell.number, x + 20, y + 20);
      }
      let fHeight = lanthanides.length > 0 ? 40 : 40;
      let actinidesY = startY + fHeight + 2;
      for (let i = 0; i < actinides.length; i++) {
        let cell = actinides[i];
        let x = startX + i * colGap;
        let y = actinidesY;
        p.fill(cell.color);
        p.stroke(85);
        p.rect(x, y, 40, 40, 5);
        p.fill(0);
        p.textSize(12);
        p.textAlign(p.CENTER, p.CENTER);
        p.text(cell.number, x + 20, y + 20);
      }
    }

    // Δημιουργούμε δύο p5 sketches, ο ένας για τον κύριο πίνακα και ο άλλος για το overlay.
    let mainSketch = function(p) {
      p.setup = function() {
        p.createCanvas(p.windowWidth, p.windowHeight);
        p.noLoop();
      };
      p.draw = function() {
        if (hideFBlock) {
          drawCollapsedTableMain(p);
        } else {
          drawFullTableMain(p);
        }
      };
      p.windowResized = function() {
        p.resizeCanvas(p.windowWidth, p.windowHeight);
        p.redraw();
      };
    };

    let overlaySketch = function(p) {
      p.setup = function() {
        p.createCanvas(p.windowWidth, p.windowHeight);
        p.clear();
        p.noLoop();
      };
      p.draw = function() {
        if (hideFBlock) {
          drawCollapsedOverlay(p);
        } else {
          p.clear();
        }
      };
      p.windowResized = function() {
        p.resizeCanvas(p.windowWidth, p.windowHeight);
        p.redraw();
      };
    };

    // Αρχικοποίηση των δεδομένων
    initialize();
    // Γέμισε τα rowsData με dummy δεδομένα για παράδειγμα
    // (σε πραγματική περίπτωση θα φορτωθούν τα στοιχεία από το elements.json και θα δημιουργηθεί ο πίνακας)
    // Για το παράδειγμα χρησιμοποιούμε την dummyFill μέσα στην initialize() παραπάνω.

    // Δημιουργούμε τα δύο sketches στα αντίστοιχα containers
    new p5(mainSketch, 'mainCanvasContainer');
    new p5(overlaySketch, 'overlayCanvasContainer');
  </script>
</body>
</html>
